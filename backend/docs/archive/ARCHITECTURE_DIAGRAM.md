# Neo Alexandria 2.0 - Complete Architecture Diagram

> âš ï¸ **DEPRECATED**: This file has been split into modular documentation.
> See `backend/docs/index.md` for the new structure.
> 
> **New locations:**
> - Architecture Overview: `backend/docs/architecture/overview.md`
> - Database Schema: `backend/docs/architecture/database.md`
> - Event System: `backend/docs/architecture/event-system.md`
> - Vertical Slice Modules: `backend/docs/architecture/modules.md`
> - Design Decisions: `backend/docs/architecture/decisions.md`

> **Visual System Architecture - Modular Vertical Slice Architecture**
> 
> This document provides comprehensive ASCII diagrams showing the modular architecture,
> class hierarchies, relationships, and data flows for the entire Neo Alexandria 2.0 system.
>
> **Last Updated**: Phase 13.5 - Vertical Slice Refactoring (Resources Module Extraction)

---

## ğŸ“‹ Table of Contents

1. [Modular Architecture Overview](#modular-architecture-overview)
2. [Phase 1-3: Foundation & Core Services](#phase-1-3-foundation--core-services)
3. [Phase 4: Advanced Search](#phase-4-advanced-search)
4. [Phase 5-7: ML Classification & Active Learning](#phase-5-7-ml-classification--active-learning)
5. [Phase 8: Three-Way Hybrid Search](#phase-8-three-way-hybrid-search)
6. [Phase 9: Quality Assessment](#phase-9-quality-assessment)
7. [Phase 10: Graph-Based Recommendations](#phase-10-graph-based-recommendations)
8. [Phase 11: Domain-Driven Design Refactoring](#phase-11-domain-driven-design-refactoring)
9. [Phase 12: Fowler Refactoring Framework](#phase-12-fowler-refactoring-framework)
10. [Phase 13.5: Vertical Slice Refactoring](#phase-135-vertical-slice-refactoring)
11. [Complete System Overview](#complete-system-overview)

---

## Modular Architecture Overview

### High-Level Modular Structure (Phase 13.5)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NEO ALEXANDRIA 2.0 - MODULAR ARCHITECTURE            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      FastAPI Application                         â”‚   â”‚
â”‚  â”‚                         (main.py)                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                         â”‚
â”‚                               â”‚ registers routers & handlers            â”‚
â”‚                               â”‚                                         â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚       â”‚                       â”‚                       â”‚                 â”‚
â”‚       â–¼                       â–¼                       â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚Resources â”‚          â”‚Collectionsâ”‚         â”‚  Search  â”‚              â”‚
â”‚  â”‚  Module  â”‚          â”‚  Module  â”‚          â”‚  Module  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚
â”‚       â”‚                     â”‚                     â”‚                     â”‚
â”‚       â”‚                     â”‚                     â”‚                     â”‚
â”‚       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                     â”‚
â”‚       â”‚    â”‚                                 â”‚    â”‚                     â”‚
â”‚       â”‚    â–¼                                 â–¼    â”‚                     â”‚
â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                     â”‚
â”‚       â”‚  â”‚       Shared Kernel                 â”‚  â”‚                     â”‚
â”‚       â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚                     â”‚
â”‚       â””â”€â–ºâ”‚  â”‚ Database â”‚  â”‚  Event Bus   â”‚     â”‚â—„â”€â”˜                     â”‚
â”‚          â”‚  â”‚ (Base,   â”‚  â”‚ (Pub/Sub)    â”‚     â”‚                        â”‚
â”‚          â”‚  â”‚Session)  â”‚  â”‚              â”‚     â”‚                        â”‚
â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                        â”‚
â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                        â”‚
â”‚          â”‚  â”‚      Base Model (GUID)       â”‚   â”‚                        â”‚
â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                        â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                         â”‚
â”‚  Event-Driven Communication:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Resources â”€â”€[resource.created]â”€â”€â–º Collections                   â”‚   â”‚
â”‚  â”‚  Resources â”€â”€[resource.updated]â”€â”€â–º Collections                   â”‚   â”‚
â”‚  â”‚  Resources â”€â”€[resource.deleted]â”€â”€â–º Collections                   â”‚   â”‚
â”‚  â”‚  Collections â”€[collection.updated]â”€â–º Resources (placeholder)     â”‚   â”‚
â”‚  â”‚  Search â”€â”€â”€â”€â”€â”€[search.executed]â”€â”€â”€â”€â–º Analytics (future)          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Vertical Slice Module Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VERTICAL SLICE MODULE PATTERN                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Each module (Resources, Collections, Search) follows this structure:   â”‚
â”‚                                                                         â”‚
â”‚  app/modules/{module_name}/                                             â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ __init__.py          # Public interface & exports                  â”‚
â”‚  â”‚   â€¢ router                                                          â”‚
â”‚  â”‚   â€¢ service functions                                               â”‚
â”‚  â”‚   â€¢ schemas                                                         â”‚
â”‚  â”‚   â€¢ models                                                          â”‚
â”‚  â”‚   â€¢ module metadata (__version__, __domain__)                       â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ router.py            # FastAPI endpoints                          â”‚
â”‚  â”‚   â€¢ HTTP request/response handling                                  â”‚
â”‚  â”‚   â€¢ Input validation                                                â”‚
â”‚  â”‚   â€¢ Calls service layer                                             â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ service.py           # Business logic                             â”‚
â”‚  â”‚   â€¢ Core domain operations                                          â”‚
â”‚  â”‚   â€¢ Orchestration                                                   â”‚
â”‚  â”‚   â€¢ Event emission                                                  â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ schema.py            # Pydantic models                            â”‚
â”‚  â”‚   â€¢ Request/response validation                                     â”‚
â”‚  â”‚   â€¢ Data serialization                                              â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ model.py             # SQLAlchemy models                          â”‚
â”‚  â”‚   â€¢ Database entities                                               â”‚
â”‚  â”‚   â€¢ String-based relationships (avoid circular imports)             â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ handlers.py          # Event handlers                             â”‚
â”‚  â”‚   â€¢ Subscribe to events from other modules                          â”‚
â”‚  â”‚   â€¢ React to system events                                          â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ README.md            # Module documentation                       â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â””â”€â”€ tests/               # Module-specific tests                      â”‚
â”‚      â””â”€â”€ __init__.py                                                   â”‚
â”‚                                                                         â”‚
â”‚  Benefits:                                                              â”‚
â”‚  â€¢ High cohesion - related code stays together                         â”‚
â”‚  â€¢ Low coupling - modules communicate via events                       â”‚
â”‚  â€¢ Independent deployment - modules can be extracted to microservices  â”‚
â”‚  â€¢ Clear boundaries - explicit public interfaces                       â”‚
â”‚  â€¢ Easy testing - isolated module tests                                â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 1-3: Foundation & Core Services

### System Foundation Architecture (Updated for Modular Structure)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APPLICATION FOUNDATION (MODULAR)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   FastAPI App    â”‚      â”‚   Configuration  â”‚     â”‚ Shared Kernel â”‚   â”‚
â”‚  â”‚   (main.py)      â”‚â—„â”€â”€â”€â”€â”€â”¤   (settings.py)  â”‚     â”‚  (database,   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  event_bus,   â”‚   â”‚
â”‚           â”‚                                         â”‚  base_model)  â”‚   â”‚
â”‚           â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                                                 â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Module Layer (Vertical Slices)              â”‚    â”‚
â”‚  â”‚                                                                â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  Resources       â”‚  â”‚  Collections     â”‚  â”‚  Search      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  Module          â”‚  â”‚  Module          â”‚  â”‚  Module      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ router.py      â”‚  â”‚ â€¢ router.py      â”‚  â”‚ â€¢ router.py  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ service.py     â”‚  â”‚ â€¢ service.py     â”‚  â”‚ â€¢ service.py â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ schema.py      â”‚  â”‚ â€¢ schema.py      â”‚  â”‚ â€¢ schema.py  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ model.py       â”‚  â”‚ â€¢ model.py       â”‚  â”‚ â€¢ handlers.pyâ”‚  â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ handlers.py    â”‚  â”‚ â€¢ handlers.py    â”‚  â”‚              â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚              â”‚                     â”‚                    â”‚               â”‚
â”‚              â”‚   Event-Driven Communication             â”‚               â”‚
â”‚              â”‚   (via shared.event_bus)                 â”‚               â”‚
â”‚              â”‚                     â”‚                    â”‚               â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                    â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Legacy Services (Being Migrated)                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚  â”‚Taxonomy  â”‚  â”‚Annotationâ”‚  â”‚ Quality  â”‚  â”‚  Graph   â”‚         â”‚   â”‚
â”‚  â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Database Model Hierarchy

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   SQLAlchemy Base   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                â”‚                â”‚                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    Resource      â”‚  â”‚ TaxonomyNode â”‚  â”‚ Collection â”‚  â”‚ Annotation â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ â€¢ id: UUID       â”‚  â”‚ â€¢ id: UUID   â”‚  â”‚ â€¢ id: UUID â”‚  â”‚ â€¢ id: UUID â”‚
    â”‚ â€¢ title: str     â”‚  â”‚ â€¢ code: str  â”‚  â”‚ â€¢ name     â”‚  â”‚ â€¢ content  â”‚
    â”‚ â€¢ description    â”‚  â”‚ â€¢ name: str  â”‚  â”‚ â€¢ owner_id â”‚  â”‚ â€¢ user_id  â”‚
    â”‚ â€¢ creator        â”‚  â”‚ â€¢ parent_id  â”‚  â”‚ â€¢ public   â”‚  â”‚ â€¢ type     â”‚
    â”‚ â€¢ subject: JSON  â”‚  â”‚ â€¢ level: int â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ â€¢ type           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ â€¢ language       â”‚         â”‚
    â”‚ â€¢ identifier     â”‚         â”‚ self-referential
    â”‚ â€¢ doi            â”‚         â–¼
    â”‚ â€¢ embedding      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ â€¢ created_at     â”‚  â”‚   children   â”‚
    â”‚ â€¢ updated_at     â”‚  â”‚  (List[Node])â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ one-to-many
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ResourceTaxonomy â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ â€¢ resource_id    â”‚
    â”‚ â€¢ taxonomy_id    â”‚
    â”‚ â€¢ confidence     â”‚
    â”‚ â€¢ method         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 4: Advanced Search

### Search Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PHASE 4: ADVANCED SEARCH                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  User Query: "machine learning algorithms"                            â”‚
â”‚       â”‚                                                               â”‚
â”‚       â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Search Router (POST /api/search/hybrid)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                       â”‚
â”‚                               â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  AdvancedSearchService                        â”‚    â”‚
â”‚  â”‚                                                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚   FTS5 Search        â”‚        â”‚   Vector Search      â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   (Keyword-based)    â”‚        â”‚   (Semantic)         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚                      â”‚        â”‚                      â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Parse query        â”‚        â”‚ â€¢ Generate embedding â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ FTS5 match         â”‚        â”‚ â€¢ Cosine similarity  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ BM25 scoring       â”‚        â”‚ â€¢ Top-k results      â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚             â”‚                               â”‚                 â”‚    â”‚
â”‚  â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚    â”‚
â”‚  â”‚                         â–¼                                     â”‚    â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚    â”‚
â”‚  â”‚              â”‚  Hybrid Fusion       â”‚                         â”‚    â”‚
â”‚  â”‚              â”‚  (Weighted Combine)  â”‚                         â”‚    â”‚
â”‚  â”‚              â”‚                      â”‚                         â”‚    â”‚
â”‚  â”‚              â”‚  score = Î±Â·fts +     â”‚                         â”‚    â”‚
â”‚  â”‚              â”‚          Î²Â·vector    â”‚                         â”‚    â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚                                         â”‚
â”‚                             â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Search Results                               â”‚  â”‚
â”‚  â”‚  â€¢ Ranked resources                                             â”‚  â”‚
â”‚  â”‚  â€¢ Facets (type, language, year)                                â”‚  â”‚
â”‚  â”‚  â€¢ Snippets with highlights                                     â”‚  â”‚
â”‚  â”‚  â€¢ Total count                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Search Service Class Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AdvancedSearchService                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Public Methods:                                                â”‚
â”‚  â€¢ hybrid_search(db, query, weight) â†’ (resources, total, ...)  â”‚
â”‚  â€¢ fts_search(db, query, filters, ...) â†’ (resources, ...)      â”‚
â”‚  â€¢ vector_search(db, query_text, ...) â†’ (resources, ...)       â”‚
â”‚  â€¢ parse_search_query(query: str) â†’ str                        â”‚
â”‚  â€¢ generate_snippets(text, query, max_len) â†’ str           bb  â”‚
â”‚                                                                â”‚
â”‚ Private Methods:                                               â”‚
â”‚  â€¢ _analyze_query(query) â†’ Dict[str, Any]                      â”‚
â”‚  â€¢ _search_sparse(db, query_text, limit) â†’ List[Tuple]         â”‚
â”‚  â€¢ _fetch_resources_ordered(db, ids, filters) â†’ List[Res]      â”‚
â”‚  â€¢ _compute_facets(db, query) â†’ Facets                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dependencies:                                                  â”‚
â”‚  â€¢ Database Session                                            â”‚
â”‚  â€¢ AI Core (embeddings)                                        â”‚
â”‚  â€¢ FTS5 (SQLite full-text search)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 5-7: ML Classification & Active Learning

### ML Classification Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PHASE 5-7: ML CLASSIFICATION & ACTIVE LEARNING             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Input Text: "Deep learning for natural language processing"            â”‚
â”‚       â”‚                                                                 â”‚
â”‚       â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         Classification Router (POST /api/classification)        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â”‚                                         â”‚
â”‚                               â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  MLClassificationService                        â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚              Model Loading (Lazy)                        â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Check if model loaded                                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Load DistilBERT/BERT from checkpoint                  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Move to GPU if available                              â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Load label mappings                                   â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                         â”‚                                       â”‚    â”‚
â”‚  â”‚                         â–¼                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚              Inference Pipeline                          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  1. Tokenize input (max 512 tokens)                      â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  2. Forward pass through model                           â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  3. Apply sigmoid activation                             â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  4. Sort by confidence                                   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  5. Take top-k predictions                               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  6. Create ClassificationResult                          â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                         â”‚                                       â”‚    â”‚
â”‚  â”‚                         â–¼                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚           Active Learning (Optional)                     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                                          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Uncertainty sampling                                  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Identify low-confidence predictions                   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Request human labels                                  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Retrain with new data                                 â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                â”‚                                        â”‚
â”‚                                â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              PredictionMonitor (Observability)                  â”‚    â”‚
â”‚  â”‚  â€¢ Log predictions                                              â”‚    â”‚ 
â”‚  â”‚  â€¢ Track confidence distribution                                â”‚    â”‚
â”‚  â”‚  â€¢ Monitor latency                                              â”‚    â”‚
â”‚  â”‚  â€¢ Detect drift                                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ML Classification Class Hierarchy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MLClassificationService                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Attributes:                                                        â”‚
â”‚  â€¢ db: Session                                                     â”‚
â”‚  â€¢ model_name: str = "distilbert-base-uncased"                     â”‚
â”‚  â€¢ model: Optional[AutoModelForSequenceClassification]             â”‚
â”‚  â€¢ tokenizer: Optional[AutoTokenizer]                              â”‚
â”‚  â€¢ id_to_label: Dict[int, str]                                     â”‚
â”‚  â€¢ label_to_id: Dict[str, int]                                     â”‚
â”‚  â€¢ monitor: PredictionMonitor                                      â”‚
â”‚  â€¢ checkpoint_dir: Path                                            â”‚
â”‚  â€¢ device: torch.device                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Public Methods:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Training & Fine-tuning                                       â”‚  â”‚ 
â”‚  â”‚  â€¢ fine_tune(labeled_data, ...) â†’ Dict[str, float]           â”‚  â”‚
â”‚  â”‚  â€¢ semi_supervised_learning(...) â†’ Dict[str, float]          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ 
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Inference                                                    â”‚  â”‚
â”‚  â”‚  â€¢ predict(text, top_k) â†’ ClassificationResult               â”‚  â”‚
â”‚  â”‚  â€¢ predict_batch(texts, top_k) â†’ List[ClassificationResult]  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Active Learning                                              â”‚  â”‚
â”‚  â”‚  â€¢ active_learning_uncertainty_sampling(...)                 â”‚  â”‚
â”‚  â”‚  â€¢ get_model_metrics(window_minutes) â†’ Dict                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Private Methods (20+ helper methods):                              â”‚
â”‚  â€¢ _load_model(), _import_ml_libraries()                           â”‚
â”‚  â€¢ _tokenize_texts(), _create_datasets()                           â”‚
â”‚  â€¢ _compute_metrics(), _calculate_classification_metrics()         â”‚
â”‚  â€¢ _build_label_mapping(), _convert_to_multihot_encoding()         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 8: Three-Way Hybrid Search

### Three-Way Hybrid Search Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PHASE 8: THREE-WAY HYBRID SEARCH                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  Query: "quantum computing applications"                               â”‚
â”‚       â”‚                                                                â”‚
â”‚       â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              HybridSearchQuery.execute()                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                â”‚                                       â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚       â”‚                        â”‚                        â”‚              â”‚
â”‚       â–¼                        â–¼                        â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  FTS5   â”‚            â”‚  Dense  â”‚            â”‚ Sparse  â”‚             â”‚
â”‚  â”‚ Search  â”‚            â”‚ Vector  â”‚            â”‚ Vector  â”‚             â”‚
â”‚  â”‚         â”‚            â”‚ Search  â”‚            â”‚ Search  â”‚             â”‚
â”‚  â”‚ â€¢ BM25  â”‚            â”‚ â€¢ BERT  â”‚            â”‚ â€¢ SPLADEâ”‚             â”‚
â”‚  â”‚ â€¢ Match â”‚            â”‚ â€¢ Cosineâ”‚            â”‚ â€¢ TF-IDFâ”‚             â”‚
â”‚  â”‚ â€¢ Score â”‚            â”‚ â€¢ Top-K â”‚            â”‚ â€¢ Top-K â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜             â”‚
â”‚       â”‚                      â”‚                      â”‚                  â”‚
â”‚       â”‚  Results: 100        â”‚  Results: 100        â”‚  Results: 100    â”‚
â”‚       â”‚                      â”‚                      â”‚                  â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                              â”‚                                         â”‚
â”‚                              â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           PHASE 2: Reciprocal Rank Fusion (RRF)                 â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  For each document d:                                           â”‚   â”‚
â”‚  â”‚    RRF(d) = Î£ [weight_i / (k + rank_i(d))]                      â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  Adaptive Weights:                                              â”‚   â”‚
â”‚  â”‚    â€¢ Short query â†’ Higher FTS5 weight                           â”‚   â”‚
â”‚  â”‚    â€¢ Long query â†’ Higher dense vector weight                    â”‚   â”‚
â”‚  â”‚    â€¢ Technical terms â†’ Higher sparse weight                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                        â”‚
â”‚                               â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           PHASE 3: ColBERT Reranking (Optional)                 â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â€¢ Take top 100 candidates                                      â”‚   â”‚
â”‚  â”‚  â€¢ Apply ColBERT cross-encoder                                  â”‚   â”‚
â”‚  â”‚  â€¢ Rerank by relevance score                                    â”‚   â”‚
â”‚  â”‚  â€¢ Timeout: 1 second                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                        â”‚
â”‚                               â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Final Ranked Results                         â”‚   â”‚
â”‚  â”‚  â€¢ Paginated resources                                          â”‚   â”‚
â”‚  â”‚  â€¢ Facets                                                       â”‚   â”‚
â”‚  â”‚  â€¢ Snippets                                                     â”‚   â”‚
â”‚  â”‚  â€¢ Metadata (latency, method contributions, weights)            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Search Pipeline Data Structures

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RetrievalCandidates                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Attributes:                                                    â”‚
â”‚  â€¢ fts5_results: List[Tuple[str, float]]                       â”‚
â”‚  â€¢ dense_results: List[Tuple[str, float]]                      â”‚
â”‚  â€¢ sparse_results: List[Tuple[str, float]]                     â”‚
â”‚  â€¢ retrieval_time_ms: float                                    â”‚
â”‚  â€¢ method_times_ms: Dict[str, float]                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Methods:                                                       â”‚
â”‚  â€¢ get_all_candidate_ids() â†’ set[str]                          â”‚
â”‚  â€¢ get_method_counts() â†’ Dict[str, int]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ feeds into
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FusedCandidates                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Attributes:                                                    â”‚
â”‚  â€¢ fused_results: List[Tuple[str, float]]                      â”‚
â”‚  â€¢ weights_used: List[float]                                   â”‚
â”‚  â€¢ fusion_time_ms: float                                       â”‚
â”‚  â€¢ method_contributions: Dict[str, int]                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Methods:                                                       â”‚
â”‚  â€¢ get_top_k(k: int) â†’ List[Tuple[str, float]]                 â”‚
â”‚  â€¢ get_candidate_ids() â†’ List[str]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 9: Quality Assessment

### Quality Assessment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PHASE 9: QUALITY ASSESSMENT                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  Resource ID: "abc-123"                                                â”‚
â”‚       â”‚                                                                â”‚
â”‚       â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         Quality Router (POST /api/quality/compute/{id})         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                        â”‚
â”‚                               â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    QualityService                              â”‚    â”‚
â”‚  â”‚                                                                â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚         Compute 5 Quality Dimensions                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Weight: 0.30                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   Accuracy     â”‚  â€¢ Data validation                   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   Score: 0.7   â”‚  â€¢ Cross-references                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â€¢ Citation accuracy                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Weight: 0.25                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Completeness   â”‚  â€¢ Required fields present           â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   Score: 0.8   â”‚  â€¢ Metadata richness                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â€¢ Description quality               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Weight: 0.20                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  Consistency   â”‚  â€¢ Format consistency                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   Score: 0.75  â”‚  â€¢ Naming conventions                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â€¢ No contradictions                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Weight: 0.15                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  Timeliness    â”‚  â€¢ Publication date                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   Score: 0.7   â”‚  â€¢ Last update time                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â€¢ Currency relevance                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Weight: 0.15                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   Relevance    â”‚  â€¢ Topic relevance                   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   Score: 0.7   â”‚  â€¢ User context                      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â€¢ Search matching                   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                         â”‚                                      â”‚    â”‚
â”‚  â”‚                         â–¼                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚           Calculate Overall Score                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  overall = 0.30Ã—accuracy + 0.25Ã—completeness +           â”‚  â”‚    â”‚
â”‚  â”‚  â”‚            0.20Ã—consistency + 0.15Ã—timeliness +          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚            0.15Ã—relevance                                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  overall = 0.735 â†’ "HIGH QUALITY"                        â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                â”‚                                       â”‚
â”‚                                â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Additional Quality Features                        â”‚   â”‚
â”‚  â”‚                                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚
â”‚  â”‚  â”‚ Outlier Detection    â”‚  â”‚ Degradation Monitor  â”‚             â”‚   â”‚
â”‚  â”‚  â”‚ (Isolation Forest)   â”‚  â”‚ (Time-based)         â”‚             â”‚   â”‚
â”‚  â”‚  â”‚                      â”‚  â”‚                      â”‚             â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ 9-dim features     â”‚  â”‚ â€¢ Compare old/new    â”‚             â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Anomaly scoring    â”‚  â”‚ â€¢ Flag >20% drop     â”‚             â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Flag for review    â”‚  â”‚ â€¢ Trigger review     â”‚             â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Quality Service Class Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      QualityService                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Attributes:                                                    â”‚
â”‚  â€¢ db: Session                                                 â”‚
â”‚  â€¢ quality_version: str = "v2.0"                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Public Methods:                                                â”‚
â”‚  â€¢ compute_quality(resource_id, weights) â†’ QualityScore        â”‚
â”‚  â€¢ monitor_quality_degradation(days) â†’ List[Dict]              â”‚
â”‚  â€¢ detect_quality_outliers(batch_size) â†’ int                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Private Methods:                                               â”‚
â”‚  â€¢ _compute_accuracy_dimension(resource) â†’ float               â”‚
â”‚  â€¢ _compute_completeness_dimension(resource) â†’ float           â”‚
â”‚  â€¢ _compute_consistency_dimension(resource) â†’ float            â”‚
â”‚  â€¢ _compute_timeliness_dimension(resource) â†’ float             â”‚
â”‚  â€¢ _compute_relevance_dimension(resource) â†’ float              â”‚
â”‚  â€¢ _update_resource_quality_fields(resource, ...) â†’ None       â”‚
â”‚  â€¢ _identify_outlier_reasons(resource) â†’ List[str]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ uses
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ContentQualityAnalyzer                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Methods:                                                       â”‚
â”‚  â€¢ metadata_completeness(resource) â†’ float                     â”‚
â”‚  â€¢ text_readability(text) â†’ Dict[str, float]                   â”‚
â”‚  â€¢ overall_quality(resource, text) â†’ float                     â”‚
â”‚  â€¢ quality_level(score) â†’ str                                  â”‚
â”‚  â€¢ source_credibility(source) â†’ float                          â”‚
â”‚  â€¢ content_depth(text) â†’ float                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 10: Graph-Based Recommendations

### Recommendation System Architecture (Strategy Pattern)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PHASE 10: GRAPH-BASED RECOMMENDATIONS                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  User ID: "user-123"                                                    â”‚
â”‚       â”‚                                                                 â”‚
â”‚       â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚    Recommendation Router (GET /api/recommendations/user/{id})   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â”‚                                         â”‚
â”‚                               â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚          RecommendationStrategyFactory.create(type, db)         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â”‚                                         â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚       â”‚                       â”‚                        â”‚                â”‚
â”‚       â–¼                       â–¼                        â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚Collabora-â”‚          â”‚ Content  â”‚           â”‚  Graph   â”‚              â”‚
â”‚  â”‚  tive    â”‚          â”‚  Based   â”‚           â”‚  Based   â”‚              â”‚
â”‚  â”‚Filtering â”‚          â”‚ Strategy â”‚           â”‚ Strategy â”‚              â”‚
â”‚  â”‚ Strategy â”‚          â”‚          â”‚           â”‚          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚
â”‚       â”‚                     â”‚                      â”‚                    â”‚
â”‚       â–¼                     â–¼                      â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚User-Item â”‚          â”‚Embedding â”‚          â”‚Citation  â”‚               â”‚
â”‚  â”‚ Matrix   â”‚          â”‚Similarityâ”‚          â”‚ Network  â”‚               â”‚
â”‚  â”‚          â”‚          â”‚          â”‚          â”‚Traversal â”‚               â”‚
â”‚  â”‚â€¢ Build   â”‚          â”‚â€¢ Profile â”‚          â”‚          â”‚               â”‚
â”‚  â”‚  matrix  â”‚          â”‚  vector  â”‚          â”‚â€¢ BFS/DFS â”‚               â”‚
â”‚  â”‚â€¢ Compute â”‚          â”‚â€¢ Cosine  â”‚          â”‚â€¢ Score   â”‚               â”‚
â”‚  â”‚  similar â”‚          â”‚  sim     â”‚          â”‚  by dist â”‚               â”‚
â”‚  â”‚  users   â”‚          â”‚â€¢ Rank    â”‚          â”‚â€¢ Weight  â”‚               â”‚
â”‚  â”‚â€¢ Predict â”‚          â”‚  items   â”‚          â”‚  edges   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜               â”‚
â”‚       â”‚                     â”‚                     â”‚                     â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                             â”‚                                           â”‚
â”‚                             â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    HybridStrategy                               â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚  â€¢ Combine results from all strategies                          â”‚    â”‚
â”‚  â”‚  â€¢ Apply weighted fusion                                        â”‚    â”‚
â”‚  â”‚  â€¢ Deduplicate recommendations                                  â”‚    â”‚
â”‚  â”‚  â€¢ Rank by combined score                                       â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚ 
â”‚  â”‚  final_score = w1Â·collab + w2Â·content + w3Â·graph                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â”‚                                         â”‚
â”‚                               â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              List[Recommendation] (Domain Objects)              â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚  Each Recommendation contains:                                  â”‚    â”‚
â”‚  â”‚   â€¢ resource_id: str                                            â”‚    â”‚
â”‚  â”‚   â€¢ user_id: str                                                â”‚    â”‚ 
â”‚  â”‚   â€¢ recommendation_score: RecommendationScore                   â”‚    â”‚ 
â”‚  â”‚   â€¢ strategy: str                                               â”‚    â”‚
â”‚  â”‚   â€¢ reason: Optional[str]                                       â”‚    â”‚
â”‚  â”‚   â€¢ metadata: Dict[str, Any]                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Strategy Pattern Class Hierarchy

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  RecommendationStrategy      â”‚
                    â”‚  (Abstract Base Class)       â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ + generate(user_id, limit)   â”‚
                    â”‚   â†’ List[Recommendation]     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ implements
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                    â”‚                    â”‚                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ Collaborative      â”‚  â”‚  Content      â”‚    â”‚   Graph       â”‚   â”‚  Hybrid  â”‚
    â”‚ FilteringStrategy  â”‚  â”‚  BasedStrategyâ”‚    â”‚BasedStrategy  â”‚   â”‚ Strategy â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚â€¢ db: Session       â”‚  â”‚â€¢ db: Session  â”‚    â”‚â€¢ db: Session  â”‚   â”‚â€¢ strats  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚â€¢ weights â”‚
    â”‚+ generate()        â”‚  â”‚+ generate()   â”‚    â”‚+ generate()   â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚- _build_matrix()   â”‚  â”‚- _build_prof()â”‚    â”‚- _traverse()  â”‚   â”‚+ generateâ”‚
    â”‚- _find_similar()   â”‚  â”‚- _compute_sim â”‚    â”‚- _score_path()â”‚   â”‚- _merge()â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Citation Graph Structure

```
                    Resource A
                    (Paper on ML)
                         â”‚
                         â”‚ cites
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                  â”‚
   Resource B                         Resource C
   (Deep Learning)                    (Neural Nets)
        â”‚                                  â”‚
        â”‚ cites                            â”‚ cites
        â–¼                                  â–¼
   Resource D â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€Resource E
   (CNNs)                            (RNNs)
        â”‚
        â”‚ cited by
        â–¼
   Resource F
   (Computer Vision)

Graph Traversal for Recommendations:
â€¢ Start from user's interacted resources
â€¢ BFS/DFS through citation network
â€¢ Score by: distance, citation count, recency
â€¢ Weight edges by citation context
```

---

## Phase 11: Domain-Driven Design Refactoring

### Domain Layer Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            PHASE 11: DOMAIN-DRIVEN DESIGN (DDD) REFACTORING             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                   â”‚  BaseDomainObject (ABC)  â”‚                          â”‚
â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚                   â”‚ + to_dict()              â”‚                          â”‚
â”‚                   â”‚ + from_dict()            â”‚                          â”‚
â”‚                   â”‚ + to_json()              â”‚                          â”‚
â”‚                   â”‚ + from_json()            â”‚                          â”‚
â”‚                   â”‚ + validate() [abstract]  â”‚                          â”‚
â”‚                   â”‚ + __eq__()               â”‚                          â”‚
â”‚                   â”‚ + __repr__()             â”‚                          â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
                             â”‚                                            â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚              â”‚                            â”‚                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚    â”‚   ValueObject      â”‚      â”‚   DomainEntity      â”‚                  â”‚
â”‚    â”‚   (dataclass)      â”‚      â”‚                     â”‚                  â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
â”‚    â”‚ Immutable          â”‚      â”‚ â€¢ entity_id: str    â”‚                  â”‚
â”‚    â”‚ Defined by values  â”‚      â”‚ Identity-based      â”‚                  â”‚
â”‚    â”‚ No identity        â”‚      â”‚ Mutable             â”‚                  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚              â”‚                                                          â”‚
â”‚              â”‚ subclasses                                               â”‚
â”‚              â”‚                                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚         â”‚         â”‚             â”‚             â”‚             â”‚      â”‚
â”‚    â–¼         â–¼         â–¼             â–¼             â–¼             â–¼      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚Class-â”‚ â”‚Class-â”‚ â”‚ Quality  â”‚ â”‚Recommend-â”‚ â”‚ Search   â”‚ â”‚ Search   â”‚   â”‚
â”‚ â”‚ifica-â”‚ â”‚ifica-â”‚ â”‚  Score   â”‚ â”‚  ation   â”‚ â”‚  Query   â”‚ â”‚ Result   â”‚   â”‚
â”‚ â”‚tion  â”‚ â”‚tion  â”‚ â”‚          â”‚ â”‚  Score   â”‚ â”‚          â”‚ â”‚          â”‚   â”‚
â”‚ â”‚Predicâ”‚ â”‚Resultâ”‚ â”‚          â”‚ â”‚          â”‚ â”‚          â”‚ â”‚          â”‚   â”‚
â”‚ â”‚tion  â”‚ â”‚      â”‚ â”‚          â”‚ â”‚          â”‚ â”‚          â”‚ â”‚          â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Domain Objects Detailed View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLASSIFICATION DOMAIN                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         ClassificationPrediction (ValueObject)               â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Attributes:                                                  â”‚      â”‚
â”‚  â”‚  â€¢ taxonomy_id: str                                          â”‚      â”‚
â”‚  â”‚  â€¢ confidence: float (0.0-1.0)                               â”‚      â”‚
â”‚  â”‚  â€¢ rank: int (1-based)                                       â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Methods:                                                     â”‚      â”‚
â”‚  â”‚  â€¢ validate()                                                â”‚      â”‚
â”‚  â”‚  â€¢ is_high_confidence(threshold=0.8) â†’ bool                  â”‚      â”‚
â”‚  â”‚  â€¢ is_low_confidence(threshold=0.5) â†’ bool                   â”‚      â”‚
â”‚  â”‚  â€¢ is_medium_confidence(low, high) â†’ bool                    â”‚      â”‚ 
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                             â”‚                                          â”‚
â”‚                             â”‚ contains multiple                        â”‚
â”‚                             â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         ClassificationResult (ValueObject)                   â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Attributes:                                                  â”‚      â”‚
â”‚  â”‚  â€¢ predictions: List[ClassificationPrediction]               â”‚      â”‚
â”‚  â”‚  â€¢ model_version: str                                        â”‚      â”‚
â”‚  â”‚  â€¢ inference_time_ms: float                                  â”‚      â”‚
â”‚  â”‚  â€¢ resource_id: Optional[str]                                â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Methods:                                                     â”‚      â”‚
â”‚  â”‚  â€¢ validate()                                                â”‚      â”‚
â”‚  â”‚  â€¢ get_high_confidence(threshold) â†’ List[Prediction]         â”‚      â”‚
â”‚  â”‚  â€¢ get_top_k(k) â†’ List[Prediction]                           â”‚      â”‚
â”‚  â”‚  â€¢ get_best_prediction() â†’ Prediction                        â”‚      â”‚
â”‚  â”‚  â€¢ count_by_confidence_level() â†’ Dict[str, int]              â”‚      â”‚
â”‚  â”‚  â€¢ to_dict() â†’ Dict[str, Any]                                â”‚      â”‚
â”‚  â”‚  â€¢ from_dict(data) â†’ ClassificationResult                    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       QUALITY DOMAIN                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              QualityScore (ValueObject)                      â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Attributes (5 Dimensions):                                   â”‚      â”‚
â”‚  â”‚  â€¢ accuracy: float (0.0-1.0)        Weight: 0.30             â”‚      â”‚
â”‚  â”‚  â€¢ completeness: float (0.0-1.0)    Weight: 0.25             â”‚      â”‚
â”‚  â”‚  â€¢ consistency: float (0.0-1.0)     Weight: 0.20             â”‚      â”‚
â”‚  â”‚  â€¢ timeliness: float (0.0-1.0)      Weight: 0.15             â”‚      â”‚
â”‚  â”‚  â€¢ relevance: float (0.0-1.0)       Weight: 0.15             â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Methods:                                                     â”‚      â”‚
â”‚  â”‚  â€¢ validate()                                                â”‚      â”‚
â”‚  â”‚  â€¢ overall_score() â†’ float                                   â”‚      â”‚
â”‚  â”‚  â€¢ is_high_quality(threshold=0.7) â†’ bool                     â”‚      â”‚
â”‚  â”‚  â€¢ is_low_quality(threshold=0.5) â†’ bool                      â”‚      â”‚
â”‚  â”‚  â€¢ get_quality_level() â†’ str ("high"/"medium"/"low")         â”‚      â”‚
â”‚  â”‚  â€¢ get_weakest_dimension() â†’ str                             â”‚      â”‚
â”‚  â”‚  â€¢ get_strongest_dimension() â†’ str                           â”‚      â”‚
â”‚  â”‚  â€¢ get_dimension_scores() â†’ Dict[str, float]                 â”‚      â”‚
â”‚  â”‚  â€¢ has_dimension_below_threshold(t) â†’ bool                   â”‚      â”‚
â”‚  â”‚  â€¢ count_dimensions_below_threshold(t) â†’ int                 â”‚      â”‚
â”‚  â”‚  â€¢ to_dict() â†’ Dict[str, Any]                                â”‚      â”‚
â”‚  â”‚  â€¢ from_dict(data) â†’ QualityScore                            â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RECOMMENDATION DOMAIN                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         RecommendationScore (ValueObject)                    â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Attributes:                                                  â”‚      â”‚
â”‚  â”‚  â€¢ score: float (0.0-1.0)                                    â”‚      â”‚
â”‚  â”‚  â€¢ confidence: float (0.0-1.0)                               â”‚      â”‚
â”‚  â”‚  â€¢ rank: int (1-based)                                       â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Methods:                                                     â”‚      â”‚
â”‚  â”‚  â€¢ validate()                                                â”‚      â”‚
â”‚  â”‚  â€¢ is_high_confidence(threshold=0.8) â†’ bool                  â”‚      â”‚
â”‚  â”‚  â€¢ is_high_score(threshold=0.7) â†’ bool                       â”‚      â”‚
â”‚  â”‚  â€¢ is_top_ranked(top_k=5) â†’ bool                             â”‚      â”‚
â”‚  â”‚  â€¢ combined_quality() â†’ float                                â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                             â”‚                                          â”‚
â”‚                             â”‚ embedded in                              â”‚
â”‚                             â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              Recommendation (ValueObject)                    â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Attributes:                                                  â”‚      â”‚
â”‚  â”‚  â€¢ resource_id: str                                          â”‚      â”‚
â”‚  â”‚  â€¢ user_id: str                                              â”‚      â”‚
â”‚  â”‚  â€¢ recommendation_score: RecommendationScore                 â”‚      â”‚
â”‚  â”‚  â€¢ strategy: str = "unknown"                                 â”‚      â”‚
â”‚  â”‚  â€¢ reason: Optional[str]                                     â”‚      â”‚
â”‚  â”‚  â€¢ metadata: Optional[Dict[str, Any]]                        â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Methods:                                                     â”‚      â”‚
â”‚  â”‚  â€¢ validate()                                                â”‚      â”‚
â”‚  â”‚  â€¢ get_score() â†’ float                                       â”‚      â”‚
â”‚  â”‚  â€¢ get_confidence() â†’ float                                  â”‚      â”‚
â”‚  â”‚  â€¢ get_rank() â†’ int                                          â”‚      â”‚
â”‚  â”‚  â€¢ is_high_quality(score_t, conf_t) â†’ bool                   â”‚      â”‚
â”‚  â”‚  â€¢ is_top_recommendation(top_k=5) â†’ bool                     â”‚      â”‚
â”‚  â”‚  â€¢ get_metadata_value(key, default) â†’ Any                    â”‚      â”‚
â”‚  â”‚  â€¢ __lt__, __le__, __gt__, __ge__ (for sorting)              â”‚      â”‚
â”‚  â”‚  â€¢ to_dict() â†’ Dict[str, Any]                                â”‚      â”‚
â”‚  â”‚  â€¢ from_dict(data) â†’ Recommendation                          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SEARCH DOMAIN                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              SearchQuery (ValueObject)                       â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Attributes:                                                  â”‚      â”‚
â”‚  â”‚  â€¢ query_text: str                                           â”‚      â”‚
â”‚  â”‚  â€¢ limit: int = 20                                           â”‚      â”‚
â”‚  â”‚  â€¢ enable_reranking: bool = True                             â”‚      â”‚
â”‚  â”‚  â€¢ adaptive_weights: bool = True                             â”‚      â”‚
â”‚  â”‚  â€¢ search_method: str = "hybrid"                             â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Methods:                                                     â”‚      â”‚
â”‚  â”‚  â€¢ validate()                                                â”‚      â”‚
â”‚  â”‚  â€¢ is_short_query(threshold=3) â†’ bool                        â”‚      â”‚
â”‚  â”‚  â€¢ is_long_query(threshold=10) â†’ bool                        â”‚      â”‚
â”‚  â”‚  â€¢ is_medium_query(short, long) â†’ bool                       â”‚      â”‚
â”‚  â”‚  â€¢ get_word_count() â†’ int                                    â”‚      â”‚
â”‚  â”‚  â€¢ is_single_word() â†’ bool                                   â”‚      â”‚
â”‚  â”‚  â€¢ get_query_length() â†’ int                                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                             â”‚                                          â”‚
â”‚                             â”‚ produces                                 â”‚
â”‚                             â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              SearchResults (ValueObject)                     â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ Attributes:                                                  â”‚      â”‚
â”‚  â”‚  â€¢ results: List[SearchResult]                               â”‚      â”‚
â”‚  â”‚  â€¢ query: SearchQuery                                        â”‚      â”‚
â”‚  â”‚  â€¢ total_results: int                                        â”‚      â”‚
â”‚  â”‚  â€¢ search_time_ms: float                                     â”‚      â”‚
â”‚  â”‚  â€¢ reranked: bool = False                                    â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|      |


## Service Layer Architecture

The service layer implements business logic and orchestrates domain objects, database operations, and external services.

### ML Classification Service

```
MLClassificationService
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ db: Session
â”‚   â”œâ”€â”€ model_name: str
â”‚   â”œâ”€â”€ model_version: Optional[str]
â”‚   â”œâ”€â”€ model: Optional[AutoModelForSequenceClassification]
â”‚   â”œâ”€â”€ tokenizer: Optional[AutoTokenizer]
â”‚   â”œâ”€â”€ id_to_label: Dict[int, str]
â”‚   â”œâ”€â”€ label_to_id: Dict[str, int]
â”‚   â”œâ”€â”€ monitor: PredictionMonitor
â”‚   â”œâ”€â”€ checkpoint_dir: Path
â”‚   â””â”€â”€ device: torch.device
â”œâ”€â”€ Constants:
â”‚   â”œâ”€â”€ DEFAULT_MODEL_NAME = "distilbert-base-uncased"
â”‚   â”œâ”€â”€ MAX_TOKEN_LENGTH = 512
â”‚   â”œâ”€â”€ DEFAULT_EPOCHS = 3
â”‚   â”œâ”€â”€ DEFAULT_BATCH_SIZE = 16
â”‚   â”œâ”€â”€ DEFAULT_LEARNING_RATE = 2e-5
â”‚   â”œâ”€â”€ BINARY_PREDICTION_THRESHOLD = 0.5
â”‚   â”œâ”€â”€ HIGH_CONFIDENCE_THRESHOLD = 0.8
â”‚   â””â”€â”€ DEFAULT_TOP_K = 5
â”œâ”€â”€ Public Methods:
â”‚   â”œâ”€â”€ __init__(db, model_name, model_version, version)
â”‚   â”œâ”€â”€ fine_tune(labeled_data, unlabeled_data, epochs, batch_size, learning_rate) -> Dict[str, float]
â”‚   â”œâ”€â”€ predict(text: str, top_k: int) -> ClassificationResult
â”‚   â”œâ”€â”€ predict_batch(texts: List[str], top_k: int) -> List[ClassificationResult]
â”‚   â”œâ”€â”€ semi_supervised_learning(labeled_data, unlabeled_data, confidence_threshold) -> Dict[str, float]
â”‚   â”œâ”€â”€ active_learning_uncertainty_sampling(unlabeled_data, limit) -> List[Tuple[str, float]]
â”‚   â””â”€â”€ get_model_metrics(window_minutes: int) -> Dict[str, Any]
â”œâ”€â”€ Private Methods:
â”‚   â”œâ”€â”€ _load_model() -> None
â”‚   â”œâ”€â”€ _import_ml_libraries() -> None
â”‚   â”œâ”€â”€ _load_tokenizer() -> None
â”‚   â”œâ”€â”€ _determine_checkpoint_path() -> Tuple[Optional[Path], Optional[str]]
â”‚   â”œâ”€â”€ _load_model_from_checkpoint(checkpoint_path, version) -> None
â”‚   â”œâ”€â”€ _try_load_checkpoint(checkpoint_path, version) -> None
â”‚   â”œâ”€â”€ _load_label_mapping(label_map_path) -> None
â”‚   â”œâ”€â”€ _load_base_model() -> None
â”‚   â”œâ”€â”€ _move_model_to_device() -> None
â”‚   â”œâ”€â”€ _compute_metrics(eval_pred) -> Dict[str, float]
â”‚   â”œâ”€â”€ _convert_logits_to_predictions(logits) -> Any
â”‚   â”œâ”€â”€ _calculate_classification_metrics(labels, predictions) -> Dict[str, float]
â”‚   â”œâ”€â”€ _build_label_mapping(labeled_data) -> int
â”‚   â”œâ”€â”€ _convert_to_multihot_encoding(labeled_data, num_labels) -> Tuple[List[str], Any]
â”‚   â”œâ”€â”€ _split_train_validation(texts, labels) -> Tuple[List[str], List[str], Any, Any]
â”‚   â”œâ”€â”€ _tokenize_texts(train_texts, val_texts) -> Tuple[Any, Any]
â”‚   â”œâ”€â”€ _create_datasets(train_encodings, val_encodings, train_labels, val_labels) -> Tuple[Any, Any]
â”‚   â”œâ”€â”€ _initialize_model_for_training(num_labels) -> None
â”‚   â”œâ”€â”€ _configure_trainer(train_dataset, val_dataset, epochs, batch_size, learning_rate) -> Trainer
â”‚   â”œâ”€â”€ _train_model(trainer) -> Dict[str, float]
â”‚   â”œâ”€â”€ _perform_semi_supervised_learning(labeled_data, unlabeled_data, eval_metrics) -> Dict[str, float]
â”‚   â”œâ”€â”€ _save_model_and_artifacts() -> None
â”‚   â””â”€â”€ _extract_metrics(eval_metrics) -> Dict[str, float]
```


### Quality Service

```
ContentQualityAnalyzer
â”œâ”€â”€ Attributes:
â”‚   â””â”€â”€ REQUIRED_KEYS: List[str] = ["title", "description", "subject", "creator", "language", "type", "identifier"]
â”œâ”€â”€ Constants:
â”‚   â”œâ”€â”€ METADATA_WEIGHT = 0.6
â”‚   â”œâ”€â”€ READABILITY_WEIGHT = 0.4
â”‚   â”œâ”€â”€ READING_EASE_MIN = 0.0
â”‚   â”œâ”€â”€ READING_EASE_MAX = 100.0
â”‚   â”œâ”€â”€ CREDIBILITY_HIGH = 0.9
â”‚   â”œâ”€â”€ CREDIBILITY_MEDIUM = 0.7
â”‚   â”œâ”€â”€ CREDIBILITY_DEFAULT = 0.6
â”‚   â”œâ”€â”€ DEPTH_THRESHOLD_MINIMAL = 100
â”‚   â”œâ”€â”€ DEPTH_THRESHOLD_SHORT = 500
â”‚   â””â”€â”€ DEPTH_THRESHOLD_MEDIUM = 2000
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ metadata_completeness(resource_in) -> float
â”‚   â”œâ”€â”€ text_readability(text: str) -> Dict[str, float]
â”‚   â”œâ”€â”€ overall_quality(resource_in, text) -> float
â”‚   â”œâ”€â”€ quality_level(score: float) -> str
â”‚   â”œâ”€â”€ source_credibility(source: Optional[str]) -> float
â”‚   â”œâ”€â”€ content_depth(text: Optional[str]) -> float
â”‚   â””â”€â”€ _normalize_reading_ease(reading_ease: float) -> float

QualityService
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ db: Session
â”‚   â””â”€â”€ quality_version: str
â”œâ”€â”€ Constants:
â”‚   â”œâ”€â”€ HIGH_QUALITY_THRESHOLD = 0.8
â”‚   â”œâ”€â”€ MEDIUM_QUALITY_THRESHOLD = 0.5
â”‚   â”œâ”€â”€ DEFAULT_QUALITY_WEIGHTS = {...}
â”‚   â”œâ”€â”€ COMPLETENESS_FIELD_WEIGHT = 0.2
â”‚   â”œâ”€â”€ DEGRADATION_THRESHOLD = 0.2
â”‚   â”œâ”€â”€ OUTLIER_MIN_RESOURCES = 10
â”‚   â”œâ”€â”€ OUTLIER_CONTAMINATION = 0.1
â”‚   â””â”€â”€ OUTLIER_THRESHOLD_LOW = 0.3
â”œâ”€â”€ Public Methods:
â”‚   â”œâ”€â”€ __init__(db, quality_version="v2.0")
â”‚   â”œâ”€â”€ compute_quality(resource_id: str, weights: Optional[Dict]) -> QualityScore
â”‚   â”œâ”€â”€ monitor_quality_degradation(time_window_days=30) -> List[Dict[str, Any]]
â”‚   â””â”€â”€ detect_quality_outliers(batch_size=1000) -> int
â”œâ”€â”€ Private Methods:
â”‚   â”œâ”€â”€ _compute_accuracy_dimension(resource) -> float
â”‚   â”œâ”€â”€ _compute_completeness_dimension(resource) -> float
â”‚   â”œâ”€â”€ _compute_consistency_dimension(resource) -> float
â”‚   â”œâ”€â”€ _compute_timeliness_dimension(resource) -> float
â”‚   â”œâ”€â”€ _compute_relevance_dimension(resource) -> float
â”‚   â”œâ”€â”€ _compute_weighted_overall_score(accuracy, completeness, consistency, timeliness, relevance, weights) -> float
â”‚   â”œâ”€â”€ _update_resource_quality_fields(resource, accuracy, completeness, consistency, timeliness, relevance, overall, weights) -> None
â”‚   â””â”€â”€ _identify_outlier_reasons(resource) -> List[str]
```


### Recommendation Service (Strategy Pattern)

```
RecommendationService
â”œâ”€â”€ Public Functions:
â”‚   â”œâ”€â”€ get_graph_based_recommendations(db, resource_id, limit=10) -> List[Dict]
â”‚   â”œâ”€â”€ generate_recommendations_with_graph_fusion(db, resource_id, limit=10, graph_weight=0.3) -> List[Dict]
â”‚   â”œâ”€â”€ generate_recommendations(db, resource_id, limit=10, strategy="hybrid", user_id) -> List[Dict]
â”‚   â”œâ”€â”€ generate_user_profile_vector(db, user_id: str) -> List[float]
â”‚   â”œâ”€â”€ recommend_based_on_annotations(db, user_id: str, limit=10) -> List[Dict]
â”‚   â””â”€â”€ get_top_subjects(db, limit=10) -> List[str]
â”œâ”€â”€ Private Functions:
â”‚   â”œâ”€â”€ _cosine_similarity(vec1, vec2) -> float
â”‚   â”œâ”€â”€ _convert_subjects_to_vector(subjects) -> List[float]
â”‚   â””â”€â”€ _to_numpy_vector(data) -> List[float]

RecommendationStrategyFactory
â”œâ”€â”€ Methods:
â”‚   â””â”€â”€ create(strategy_type: str, db: Session) -> RecommendationStrategy

RecommendationStrategy (ABC)
â”œâ”€â”€ Methods:
â”‚   â””â”€â”€ generate(user_id: str, limit: int) -> List[Recommendation]
â”œâ”€â”€ Implementations:
â”‚   â”œâ”€â”€ CollaborativeFilteringStrategy
â”‚   â”‚   â”œâ”€â”€ Attributes:
â”‚   â”‚   â”‚   â””â”€â”€ db: Session
â”‚   â”‚   â””â”€â”€ Methods:
â”‚   â”‚       â”œâ”€â”€ generate(user_id, limit) -> List[Recommendation]
â”‚   â”‚       â””â”€â”€ _build_user_item_matrix() -> Tuple[np.ndarray, List[str], List[str]]
â”‚   â”‚
â”‚   â”œâ”€â”€ ContentBasedStrategy
â”‚   â”‚   â”œâ”€â”€ Attributes:
â”‚   â”‚   â”‚   â””â”€â”€ db: Session
â”‚   â”‚   â””â”€â”€ Methods:
â”‚   â”‚       â”œâ”€â”€ generate(user_id, limit) -> List[Recommendation]
â”‚   â”‚       â”œâ”€â”€ _build_user_profile(interactions) -> List[float]
â”‚   â”‚       â””â”€â”€ _compute_similarity(profile, resource_embedding) -> float
â”‚   â”‚
â”‚   â”œâ”€â”€ GraphBasedStrategy
â”‚   â”‚   â”œâ”€â”€ Attributes:
â”‚   â”‚   â”‚   â””â”€â”€ db: Session
â”‚   â”‚   â””â”€â”€ Methods:
â”‚   â”‚       â”œâ”€â”€ generate(user_id, limit) -> List[Recommendation]
â”‚   â”‚       â””â”€â”€ _traverse_citation_network(resource_id, depth=2) -> List[Tuple[str, float]]
â”‚   â”‚
â”‚   â””â”€â”€ HybridStrategy
â”‚       â”œâ”€â”€ Attributes:
â”‚       â”‚   â”œâ”€â”€ db: Session
â”‚       â”‚   â”œâ”€â”€ strategies: List[RecommendationStrategy]
â”‚       â”‚   â””â”€â”€ weights: List[float]
â”‚       â””â”€â”€ Methods:
â”‚           â”œâ”€â”€ generate(user_id, limit) -> List[Recommendation]
â”‚           â””â”€â”€ _merge_recommendations(strategy_results, weights) -> List[Recommendation]
```


### Search Service

```
AdvancedSearchService
â”œâ”€â”€ Public Methods:
â”‚   â”œâ”€â”€ hybrid_search(db, query, hybrid_weight=0.5) -> Tuple[List[Resource], int, Facets, Dict[str, str]]
â”‚   â”œâ”€â”€ fts_search(db, query, filters, limit, offset) -> Tuple[List[Resource], int, Facets, Dict[str, float], Dict[str, str]]
â”‚   â”œâ”€â”€ vector_search(db, query_text, limit, offset) -> Tuple[List[Resource], int, Facets]
â”‚   â”œâ”€â”€ parse_search_query(query: str) -> str
â”‚   â”œâ”€â”€ generate_snippets(text: str, query: str, max_length=200) -> str
â”‚   â””â”€â”€ _analyze_query(query: str) -> Dict[str, Any]
â”œâ”€â”€ Private Methods:
â”‚   â”œâ”€â”€ _search_sparse(db, query_text, limit=100) -> List[Tuple[str, float]]
â”‚   â”œâ”€â”€ _fetch_resources_ordered(db, resource_ids, filters) -> List[Resource]
â”‚   â””â”€â”€ _compute_facets(db, query) -> Facets

HybridSearchQuery
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ db: Session
â”‚   â”œâ”€â”€ query: DomainSearchQuery
â”‚   â”œâ”€â”€ enable_reranking: bool
â”‚   â”œâ”€â”€ adaptive_weighting: bool
â”‚   â””â”€â”€ _diagnostics: Dict[str, Any]
â”œâ”€â”€ Public Methods:
â”‚   â”œâ”€â”€ __init__(db, query, enable_reranking=True, adaptive_weighting=True)
â”‚   â”œâ”€â”€ execute() -> Tuple[List[Resource], int, Facets, Dict[str, str], Dict[str, Any]]
â”‚   â””â”€â”€ get_diagnostic_info() -> Dict[str, Any]
â”œâ”€â”€ Private Methods:
â”‚   â”œâ”€â”€ _convert_to_schema_filters() -> SearchFilters | None
â”‚   â”œâ”€â”€ _ensure_tables_exist() -> None
â”‚   â”œâ”€â”€ _check_services_available() -> bool
â”‚   â”œâ”€â”€ _fallback_to_two_way_hybrid(start_time) -> Tuple[...]
â”‚   â”œâ”€â”€ _analyze_query() -> Dict[str, Any]
â”‚   â”œâ”€â”€ _execute_retrieval_phase() -> RetrievalCandidates
â”‚   â”œâ”€â”€ _execute_fusion_phase(candidates) -> FusedCandidates
â”‚   â”œâ”€â”€ _execute_reranking_phase(fused) -> List[Tuple[str, float]]
â”‚   â”œâ”€â”€ _search_fts5() -> List[Tuple[str, float]]
â”‚   â”œâ”€â”€ _search_dense() -> List[Tuple[str, float]]
â”‚   â”œâ”€â”€ _search_sparse() -> List[Tuple[str, float]]
â”‚   â”œâ”€â”€ _compute_weights() -> List[float]
â”‚   â”œâ”€â”€ _compute_method_contributions(fts5, dense, sparse) -> Dict[str, int]
â”‚   â”œâ”€â”€ _fetch_paginated_resources(fused_results) -> List[Resource]
â”‚   â”œâ”€â”€ _compute_facets(fused_results) -> Facets
â”‚   â””â”€â”€ _generate_snippets(resources) -> Dict[str, str]

RetrievalCandidates (dataclass)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ fts5_results: List[Tuple[str, float]]
â”‚   â”œâ”€â”€ dense_results: List[Tuple[str, float]]
â”‚   â”œâ”€â”€ sparse_results: List[Tuple[str, float]]
â”‚   â”œâ”€â”€ retrieval_time_ms: float
â”‚   â””â”€â”€ method_times_ms: Dict[str, float]
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ get_all_candidate_ids() -> set[str]
â”‚   â””â”€â”€ get_method_counts() -> Dict[str, int]

FusedCandidates (dataclass)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ fused_results: List[Tuple[str, float]]
â”‚   â”œâ”€â”€ weights_used: List[float]
â”‚   â”œâ”€â”€ fusion_time_ms: float
â”‚   â””â”€â”€ method_contributions: Dict[str, int]
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ get_top_k(k: int) -> List[Tuple[str, float]]
â”‚   â””â”€â”€ get_candidate_ids() -> List[str]

Module Functions:
â”œâ”€â”€ _detect_fts5(db: Session) -> bool
â”œâ”€â”€ _fts_index_ready(db: Session) -> bool
â”œâ”€â”€ _apply_structured_filters(q, filters) -> Any
â””â”€â”€ _compute_facets(db, query) -> Facets
```

---


## Refactoring Framework Architecture

The refactoring framework implements Fowler's refactoring patterns with automated code smell detection and validation.

### Refactoring Models

```
SmellType (Enum)
â”œâ”€â”€ Values:
â”‚   â”œâ”€â”€ DUPLICATED_CODE
â”‚   â”œâ”€â”€ LONG_FUNCTION
â”‚   â”œâ”€â”€ LARGE_CLASS
â”‚   â”œâ”€â”€ GLOBAL_DATA
â”‚   â”œâ”€â”€ FEATURE_ENVY
â”‚   â”œâ”€â”€ DATA_CLUMPS
â”‚   â”œâ”€â”€ PRIMITIVE_OBSESSION
â”‚   â”œâ”€â”€ REPEATED_SWITCHES
â”‚   â”œâ”€â”€ DATA_CLASS
â”‚   â””â”€â”€ LONG_PARAMETER_LIST

Severity (Enum)
â”œâ”€â”€ Values:
â”‚   â”œâ”€â”€ HIGH (blocks production)
â”‚   â”œâ”€â”€ MEDIUM (technical debt)
â”‚   â””â”€â”€ LOW (minor improvement)

RefactoringTechnique (Enum)
â”œâ”€â”€ Values:
â”‚   â”œâ”€â”€ EXTRACT_FUNCTION
â”‚   â”œâ”€â”€ EXTRACT_CLASS
â”‚   â”œâ”€â”€ REPLACE_PRIMITIVE_WITH_OBJECT
â”‚   â”œâ”€â”€ COMBINE_FUNCTIONS_INTO_CLASS
â”‚   â”œâ”€â”€ SEPARATE_QUERY_FROM_MODIFIER
â”‚   â”œâ”€â”€ ENCAPSULATE_COLLECTION
â”‚   â”œâ”€â”€ SPLIT_PHASE
â”‚   â”œâ”€â”€ REPLACE_CONDITIONAL_WITH_POLYMORPHISM
â”‚   â”œâ”€â”€ MOVE_FUNCTION
â”‚   â””â”€â”€ INLINE_FUNCTION

Location (dataclass)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ file_path: Path
â”‚   â”œâ”€â”€ start_line: int
â”‚   â”œâ”€â”€ end_line: int
â”‚   â”œâ”€â”€ function_name: Optional[str]
â”‚   â””â”€â”€ class_name: Optional[str]
â”œâ”€â”€ Methods:
â”‚   â””â”€â”€ __str__() -> str

CodeSmell (dataclass)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ smell_type: SmellType
â”‚   â”œâ”€â”€ severity: Severity
â”‚   â”œâ”€â”€ location: Location
â”‚   â”œâ”€â”€ description: str
â”‚   â”œâ”€â”€ suggested_technique: RefactoringTechnique
â”‚   â””â”€â”€ metrics: Dict[str, Any]
â”œâ”€â”€ Methods:
â”‚   â””â”€â”€ __str__() -> str

SmellReport (dataclass)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ file_path: Path
â”‚   â”œâ”€â”€ smells: List[CodeSmell]
â”‚   â”œâ”€â”€ total_lines: int
â”‚   â”œâ”€â”€ complexity_score: float
â”‚   â””â”€â”€ timestamp: str
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ high_priority_smells() -> List[CodeSmell]
â”‚   â”œâ”€â”€ smells_by_type(smell_type) -> List[CodeSmell]
â”‚   â””â”€â”€ summary() -> str

RefactoringResult (dataclass)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ success: bool
â”‚   â”œâ”€â”€ original_code: str
â”‚   â”œâ”€â”€ refactored_code: str
â”‚   â”œâ”€â”€ technique_applied: RefactoringTechnique
â”‚   â”œâ”€â”€ changes_made: List[str]
â”‚   â””â”€â”€ test_results: Optional[TestResults]
â”œâ”€â”€ Methods:
â”‚   â””â”€â”€ summary() -> str

TestResults (dataclass)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ total_tests: int
â”‚   â”œâ”€â”€ passed: int
â”‚   â”œâ”€â”€ failed: int
â”‚   â”œâ”€â”€ errors: List[str]
â”‚   â”œâ”€â”€ coverage_percentage: float
â”‚   â””â”€â”€ execution_time_seconds: float
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ all_passed() -> bool
â”‚   â”œâ”€â”€ coverage_acceptable(threshold=0.85) -> bool
â”‚   â””â”€â”€ summary() -> str

ServiceRefactoringStatus (dataclass)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ service_name: str
â”‚   â”œâ”€â”€ file_path: Path
â”‚   â”œâ”€â”€ status: str
â”‚   â”œâ”€â”€ smells_detected: int
â”‚   â”œâ”€â”€ smells_fixed: int
â”‚   â”œâ”€â”€ techniques_applied: List[RefactoringTechnique]
â”‚   â”œâ”€â”€ test_coverage_before: float
â”‚   â”œâ”€â”€ test_coverage_after: float
â”‚   â”œâ”€â”€ lines_before: int
â”‚   â”œâ”€â”€ lines_after: int
â”‚   â”œâ”€â”€ functions_before: int
â”‚   â””â”€â”€ functions_after: int
â”œâ”€â”€ Methods:
â”‚   â””â”€â”€ improvement_percentage() -> float
```


### Refactoring Detector

```
PrioritizedSmells (dataclass)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ high_priority: List[CodeSmell]
â”‚   â”œâ”€â”€ medium_priority: List[CodeSmell]
â”‚   â””â”€â”€ low_priority: List[CodeSmell]
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ total_count() -> int
â”‚   â””â”€â”€ summary() -> str

CodeSmellDetector
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ function_checker: FunctionLengthChecker
â”‚   â”œâ”€â”€ class_checker: ClassSizeChecker
â”‚   â”œâ”€â”€ type_hint_checker: TypeHintCoverageChecker
â”‚   â””â”€â”€ duplication_detector: CodeDuplicationDetector
â”œâ”€â”€ Public Methods:
â”‚   â”œâ”€â”€ __init__()
â”‚   â”œâ”€â”€ analyze_file(file_path: Path) -> SmellReport
â”‚   â”œâ”€â”€ analyze_directory(dir_path: Path) -> List[SmellReport]
â”‚   â”œâ”€â”€ prioritize_smells(reports: List[SmellReport]) -> PrioritizedSmells
â”‚   â””â”€â”€ generate_summary_report(reports: List[SmellReport]) -> str
â”œâ”€â”€ Private Methods:
â”‚   â”œâ”€â”€ _detect_feature_envy(file_path) -> List[CodeSmell]
â”‚   â”œâ”€â”€ _detect_long_parameter_lists(file_path) -> List[CodeSmell]
â”‚   â”œâ”€â”€ _count_lines(file_path) -> int
â”‚   â””â”€â”€ _calculate_complexity(file_path) -> float
```

### Refactoring Validators

```
FunctionInfo (dataclass)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ name: str
â”‚   â”œâ”€â”€ start_line: int
â”‚   â”œâ”€â”€ end_line: int
â”‚   â”œâ”€â”€ line_count: int
â”‚   â”œâ”€â”€ class_name: Optional[str]
â”‚   â”œâ”€â”€ has_type_hints: bool
â”‚   â””â”€â”€ parameter_count: int

ClassInfo (dataclass)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ name: str
â”‚   â”œâ”€â”€ start_line: int
â”‚   â”œâ”€â”€ end_line: int
â”‚   â”œâ”€â”€ line_count: int
â”‚   â”œâ”€â”€ method_count: int
â”‚   â””â”€â”€ public_method_count: int

FunctionLengthChecker
â”œâ”€â”€ Attributes:
â”‚   â””â”€â”€ max_lines: int
â”œâ”€â”€ Constants:
â”‚   â””â”€â”€ MAX_FUNCTION_LINES = 50
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ __init__(max_lines=50)
â”‚   â”œâ”€â”€ check_file(file_path: Path) -> List[CodeSmell]
â”‚   â”œâ”€â”€ _extract_functions(tree, source) -> List[FunctionInfo]
â”‚   â”œâ”€â”€ _analyze_function(node, source) -> FunctionInfo
â”‚   â””â”€â”€ _create_smell(file_path, func) -> CodeSmell

ClassSizeChecker
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ max_lines: int
â”‚   â””â”€â”€ max_methods: int
â”œâ”€â”€ Constants:
â”‚   â”œâ”€â”€ MAX_CLASS_LINES = 200
â”‚   â””â”€â”€ MAX_METHODS = 10
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ __init__(max_lines=200, max_methods=10)
â”‚   â”œâ”€â”€ check_file(file_path: Path) -> List[CodeSmell]
â”‚   â”œâ”€â”€ _extract_classes(tree, source) -> List[ClassInfo]
â”‚   â”œâ”€â”€ _analyze_class(node, source) -> ClassInfo
â”‚   â””â”€â”€ _create_smell(file_path, cls) -> CodeSmell

TypeHintCoverageChecker
â”œâ”€â”€ Attributes:
â”‚   â””â”€â”€ min_coverage: float
â”œâ”€â”€ Constants:
â”‚   â””â”€â”€ MIN_TYPE_HINT_COVERAGE = 1.0
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ __init__(min_coverage=1.0)
â”‚   â”œâ”€â”€ check_file(file_path: Path) -> Tuple[float, List[CodeSmell]]
â”‚   â”œâ”€â”€ _has_complete_type_hints(node) -> bool
â”‚   â””â”€â”€ _create_smell(file_path, node) -> CodeSmell

CodeDuplicationDetector
â”œâ”€â”€ Attributes:
â”‚   â””â”€â”€ similarity_threshold: float
â”œâ”€â”€ Constants:
â”‚   â””â”€â”€ DUPLICATION_SIMILARITY_THRESHOLD = 0.8
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ __init__(similarity_threshold=0.8)
â”‚   â”œâ”€â”€ check_files(file_paths: List[Path]) -> List[CodeSmell]
â”‚   â”œâ”€â”€ _extract_function_bodies(tree, source) -> List[Tuple[ast.FunctionDef, str]]
â”‚   â”œâ”€â”€ _calculate_similarity(body1, body2) -> float
â”‚   â””â”€â”€ _create_smell(file1, func1, file2, func2, similarity) -> CodeSmell
```

---


## Router Layer Architecture

The router layer provides FastAPI endpoints for all services, implementing REST API patterns.

### Main Routers

```
Classification Router (/api/classification)
â”œâ”€â”€ Endpoints:
â”‚   â”œâ”€â”€ POST /classify
â”‚   â”‚   â”œâ”€â”€ Input: ClassifyRequest (text, top_k)
â”‚   â”‚   â””â”€â”€ Output: ClassificationResult
â”‚   â”œâ”€â”€ POST /fine-tune
â”‚   â”‚   â”œâ”€â”€ Input: FineTuneRequest (labeled_data, epochs, batch_size)
â”‚   â”‚   â””â”€â”€ Output: TrainingMetrics
â”‚   â””â”€â”€ GET /metrics
â”‚       â””â”€â”€ Output: ModelMetrics

Quality Router (/api/quality)
â”œâ”€â”€ Endpoints:
â”‚   â”œâ”€â”€ POST /compute/{resource_id}
â”‚   â”‚   â”œâ”€â”€ Input: Optional[QualityWeights]
â”‚   â”‚   â””â”€â”€ Output: QualityScore
â”‚   â”œâ”€â”€ GET /monitor/degradation
â”‚   â”‚   â”œâ”€â”€ Query: time_window_days
â”‚   â”‚   â””â”€â”€ Output: List[DegradationReport]
â”‚   â””â”€â”€ POST /detect/outliers
â”‚       â”œâ”€â”€ Query: batch_size
â”‚       â””â”€â”€ Output: OutlierDetectionResult

Recommendation Router (/api/recommendations)
â”œâ”€â”€ Endpoints:
â”‚   â”œâ”€â”€ GET /user/{user_id}
â”‚   â”‚   â”œâ”€â”€ Query: limit, strategy
â”‚   â”‚   â””â”€â”€ Output: List[Recommendation]
â”‚   â”œâ”€â”€ GET /resource/{resource_id}
â”‚   â”‚   â”œâ”€â”€ Query: limit
â”‚   â”‚   â””â”€â”€ Output: List[Recommendation]
â”‚   â””â”€â”€ GET /graph/{resource_id}
â”‚       â”œâ”€â”€ Query: limit, graph_weight
â”‚       â””â”€â”€ Output: List[Recommendation]

Search Router (/api/search)
â”œâ”€â”€ Endpoints:
â”‚   â”œâ”€â”€ POST /hybrid
â”‚   â”‚   â”œâ”€â”€ Input: SearchQuery
â”‚   â”‚   â””â”€â”€ Output: SearchResults
â”‚   â”œâ”€â”€ POST /fts
â”‚   â”‚   â”œâ”€â”€ Input: SearchQuery
â”‚   â”‚   â””â”€â”€ Output: SearchResults
â”‚   â”œâ”€â”€ POST /vector
â”‚   â”‚   â”œâ”€â”€ Input: SearchQuery
â”‚   â”‚   â””â”€â”€ Output: SearchResults
â”‚   â””â”€â”€ POST /three-way
â”‚       â”œâ”€â”€ Input: SearchQuery
â”‚       â””â”€â”€ Output: SearchResults

Resource Router (/api/resources)
â”œâ”€â”€ Endpoints:
â”‚   â”œâ”€â”€ GET /
â”‚   â”‚   â”œâ”€â”€ Query: skip, limit, filters
â”‚   â”‚   â””â”€â”€ Output: List[Resource]
â”‚   â”œâ”€â”€ GET /{resource_id}
â”‚   â”‚   â””â”€â”€ Output: Resource
â”‚   â”œâ”€â”€ POST /
â”‚   â”‚   â”œâ”€â”€ Input: ResourceCreate
â”‚   â”‚   â””â”€â”€ Output: Resource
â”‚   â”œâ”€â”€ PUT /{resource_id}
â”‚   â”‚   â”œâ”€â”€ Input: ResourceUpdate
â”‚   â”‚   â””â”€â”€ Output: Resource
â”‚   â””â”€â”€ DELETE /{resource_id}
â”‚       â””â”€â”€ Output: DeleteResponse

Taxonomy Router (/api/taxonomy)
â”œâ”€â”€ Endpoints:
â”‚   â”œâ”€â”€ GET /nodes
â”‚   â”‚   â””â”€â”€ Output: List[TaxonomyNode]
â”‚   â”œâ”€â”€ GET /nodes/{node_id}
â”‚   â”‚   â””â”€â”€ Output: TaxonomyNode
â”‚   â”œâ”€â”€ POST /nodes
â”‚   â”‚   â”œâ”€â”€ Input: TaxonomyNodeCreate
â”‚   â”‚   â””â”€â”€ Output: TaxonomyNode
â”‚   â””â”€â”€ GET /tree
â”‚       â””â”€â”€ Output: TaxonomyTree

Annotation Router (/api/annotations)
â”œâ”€â”€ Endpoints:
â”‚   â”œâ”€â”€ GET /resource/{resource_id}
â”‚   â”‚   â””â”€â”€ Output: List[Annotation]
â”‚   â”œâ”€â”€ POST /
â”‚   â”‚   â”œâ”€â”€ Input: AnnotationCreate
â”‚   â”‚   â””â”€â”€ Output: Annotation
â”‚   â”œâ”€â”€ PUT /{annotation_id}
â”‚   â”‚   â”œâ”€â”€ Input: AnnotationUpdate
â”‚   â”‚   â””â”€â”€ Output: Annotation
â”‚   â””â”€â”€ DELETE /{annotation_id}
â”‚       â””â”€â”€ Output: DeleteResponse

Graph Router (/api/graph)
â”œâ”€â”€ Endpoints:
â”‚   â”œâ”€â”€ GET /citations/{resource_id}
â”‚   â”‚   â””â”€â”€ Output: CitationGraph
â”‚   â”œâ”€â”€ GET /embeddings/{resource_id}
â”‚   â”‚   â””â”€â”€ Output: GraphEmbedding
â”‚   â””â”€â”€ POST /analyze
â”‚       â”œâ”€â”€ Input: GraphAnalysisRequest
â”‚       â””â”€â”€ Output: GraphAnalysisResult
```

---


## Database Layer Architecture

The database layer implements SQLAlchemy ORM models and database operations.

### Core Database Models

```
Resource (SQLAlchemy Model)
â”œâ”€â”€ Table: resources
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ id: UUID (PK)
â”‚   â”œâ”€â”€ title: String
â”‚   â”œâ”€â”€ description: Text
â”‚   â”œâ”€â”€ creator: String
â”‚   â”œâ”€â”€ subject: JSON (List[str])
â”‚   â”œâ”€â”€ type: String
â”‚   â”œâ”€â”€ language: String
â”‚   â”œâ”€â”€ identifier: String
â”‚   â”œâ”€â”€ doi: String
â”‚   â”œâ”€â”€ publication_year: Integer
â”‚   â”œâ”€â”€ classification_code: String
â”‚   â”œâ”€â”€ embedding: JSON (List[float])
â”‚   â”œâ”€â”€ sparse_embedding: JSON
â”‚   â”œâ”€â”€ quality_overall: Float
â”‚   â”œâ”€â”€ quality_accuracy: Float
â”‚   â”œâ”€â”€ quality_completeness: Float
â”‚   â”œâ”€â”€ quality_consistency: Float
â”‚   â”œâ”€â”€ quality_timeliness: Float
â”‚   â”œâ”€â”€ quality_relevance: Float
â”‚   â”œâ”€â”€ quality_weights: JSON
â”‚   â”œâ”€â”€ quality_computation_version: String
â”‚   â”œâ”€â”€ quality_last_computed: DateTime
â”‚   â”œâ”€â”€ is_quality_outlier: Boolean
â”‚   â”œâ”€â”€ outlier_score: Float
â”‚   â”œâ”€â”€ outlier_reasons: JSON
â”‚   â”œâ”€â”€ needs_quality_review: Boolean
â”‚   â”œâ”€â”€ created_at: DateTime
â”‚   â””â”€â”€ updated_at: DateTime
â”œâ”€â”€ Relationships:
â”‚   â”œâ”€â”€ annotations: List[Annotation]
â”‚   â”œâ”€â”€ citations: List[Citation]
â”‚   â”œâ”€â”€ taxonomy_assignments: List[ResourceTaxonomy]
â”‚   â””â”€â”€ interactions: List[UserInteraction]

TaxonomyNode (SQLAlchemy Model)
â”œâ”€â”€ Table: taxonomy_nodes
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ id: UUID (PK)
â”‚   â”œâ”€â”€ code: String (unique)
â”‚   â”œâ”€â”€ name: String
â”‚   â”œâ”€â”€ description: Text
â”‚   â”œâ”€â”€ parent_id: UUID (FK)
â”‚   â”œâ”€â”€ level: Integer
â”‚   â”œâ”€â”€ created_at: DateTime
â”‚   â””â”€â”€ updated_at: DateTime
â”œâ”€â”€ Relationships:
â”‚   â”œâ”€â”€ parent: TaxonomyNode
â”‚   â”œâ”€â”€ children: List[TaxonomyNode]
â”‚   â””â”€â”€ resource_assignments: List[ResourceTaxonomy]

ResourceTaxonomy (SQLAlchemy Model)
â”œâ”€â”€ Table: resource_taxonomy
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ id: UUID (PK)
â”‚   â”œâ”€â”€ resource_id: UUID (FK)
â”‚   â”œâ”€â”€ taxonomy_node_id: UUID (FK)
â”‚   â”œâ”€â”€ confidence: Float
â”‚   â”œâ”€â”€ assigned_by: String
â”‚   â”œâ”€â”€ assignment_method: String
â”‚   â”œâ”€â”€ created_at: DateTime
â”‚   â””â”€â”€ updated_at: DateTime
â”œâ”€â”€ Relationships:
â”‚   â”œâ”€â”€ resource: Resource
â”‚   â””â”€â”€ taxonomy_node: TaxonomyNode

Annotation (SQLAlchemy Model)
â”œâ”€â”€ Table: annotations
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ id: UUID (PK)
â”‚   â”œâ”€â”€ resource_id: UUID (FK)
â”‚   â”œâ”€â”€ user_id: String
â”‚   â”œâ”€â”€ content: Text
â”‚   â”œâ”€â”€ annotation_type: String
â”‚   â”œâ”€â”€ start_position: Integer
â”‚   â”œâ”€â”€ end_position: Integer
â”‚   â”œâ”€â”€ tags: JSON (List[str])
â”‚   â”œâ”€â”€ created_at: DateTime
â”‚   â””â”€â”€ updated_at: DateTime
â”œâ”€â”€ Relationships:
â”‚   â””â”€â”€ resource: Resource

Citation (SQLAlchemy Model)
â”œâ”€â”€ Table: citations
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ id: UUID (PK)
â”‚   â”œâ”€â”€ source_resource_id: UUID (FK)
â”‚   â”œâ”€â”€ target_resource_id: UUID (FK)
â”‚   â”œâ”€â”€ citation_type: String
â”‚   â”œâ”€â”€ context: Text
â”‚   â”œâ”€â”€ created_at: DateTime
â”‚   â””â”€â”€ updated_at: DateTime
â”œâ”€â”€ Relationships:
â”‚   â”œâ”€â”€ source_resource: Resource
â”‚   â””â”€â”€ target_resource: Resource

UserInteraction (SQLAlchemy Model)
â”œâ”€â”€ Table: user_interactions
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ id: UUID (PK)
â”‚   â”œâ”€â”€ user_id: String
â”‚   â”œâ”€â”€ resource_id: UUID (FK)
â”‚   â”œâ”€â”€ interaction_type: String
â”‚   â”œâ”€â”€ rating: Float
â”‚   â”œâ”€â”€ duration_seconds: Integer
â”‚   â”œâ”€â”€ created_at: DateTime
â”‚   â””â”€â”€ updated_at: DateTime
â”œâ”€â”€ Relationships:
â”‚   â””â”€â”€ resource: Resource

Collection (SQLAlchemy Model)
â”œâ”€â”€ Table: collections
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ id: UUID (PK)
â”‚   â”œâ”€â”€ name: String
â”‚   â”œâ”€â”€ description: Text
â”‚   â”œâ”€â”€ owner_id: String
â”‚   â”œâ”€â”€ is_public: Boolean
â”‚   â”œâ”€â”€ created_at: DateTime
â”‚   â””â”€â”€ updated_at: DateTime
â”œâ”€â”€ Relationships:
â”‚   â””â”€â”€ resources: List[Resource] (many-to-many)
```

### Database Session Management

```
SessionLocal
â”œâ”€â”€ Factory function for creating database sessions
â”œâ”€â”€ Usage: with SessionLocal() as db: ...

get_db()
â”œâ”€â”€ FastAPI dependency for database sessions
â”œâ”€â”€ Yields: Session
â””â”€â”€ Usage: db: Session = Depends(get_db)

Base
â”œâ”€â”€ SQLAlchemy declarative base
â””â”€â”€ All models inherit from Base
```

---


## Utility Layer Architecture

The utility layer provides helper functions and shared utilities across the application.

### Text Processing Utilities

```
text_processor module
â”œâ”€â”€ Functions:
â”‚   â”œâ”€â”€ readability_scores(text: str) -> Dict[str, float]
â”‚   â”‚   â”œâ”€â”€ Returns: flesch_reading_ease, flesch_kincaid_grade, etc.
â”‚   â”‚   â””â”€â”€ Uses: textstat library
â”‚   â”œâ”€â”€ extract_keywords(text: str, top_k: int) -> List[str]
â”‚   â”‚   â”œâ”€â”€ Returns: List of top keywords
â”‚   â”‚   â””â”€â”€ Uses: TF-IDF or RAKE
â”‚   â”œâ”€â”€ clean_text(text: str) -> str
â”‚   â”‚   â”œâ”€â”€ Removes: HTML tags, special characters
â”‚   â”‚   â””â”€â”€ Returns: Cleaned text
â”‚   â”œâ”€â”€ tokenize(text: str) -> List[str]
â”‚   â”‚   â””â”€â”€ Returns: List of tokens
â”‚   â””â”€â”€ normalize_text(text: str) -> str
â”‚       â”œâ”€â”€ Lowercases, removes punctuation
â”‚       â””â”€â”€ Returns: Normalized text

content_extractor module
â”œâ”€â”€ Functions:
â”‚   â”œâ”€â”€ extract_from_pdf(file_path: Path) -> str
â”‚   â”‚   â””â”€â”€ Uses: PyPDF2 or pdfplumber
â”‚   â”œâ”€â”€ extract_from_html(html: str) -> str
â”‚   â”‚   â””â”€â”€ Uses: BeautifulSoup
â”‚   â”œâ”€â”€ extract_metadata(file_path: Path) -> Dict[str, Any]
â”‚   â”‚   â””â”€â”€ Returns: Title, author, date, etc.
â”‚   â””â”€â”€ extract_citations(text: str) -> List[str]
â”‚       â””â”€â”€ Returns: List of citation strings

table_extractor module
â”œâ”€â”€ Functions:
â”‚   â”œâ”€â”€ extract_tables_from_pdf(file_path: Path) -> List[pd.DataFrame]
â”‚   â”‚   â””â”€â”€ Uses: tabula-py or camelot
â”‚   â”œâ”€â”€ extract_tables_from_html(html: str) -> List[pd.DataFrame]
â”‚   â”‚   â””â”€â”€ Uses: pandas.read_html
â”‚   â””â”€â”€ format_table_as_text(df: pd.DataFrame) -> str
â”‚       â””â”€â”€ Returns: Formatted table string

equation_parser module
â”œâ”€â”€ Functions:
â”‚   â”œâ”€â”€ extract_equations(text: str) -> List[str]
â”‚   â”‚   â””â”€â”€ Returns: List of LaTeX equations
â”‚   â”œâ”€â”€ parse_latex(latex: str) -> Dict[str, Any]
â”‚   â”‚   â””â”€â”€ Returns: Parsed equation structure
â”‚   â””â”€â”€ render_equation(latex: str) -> Image
â”‚       â””â”€â”€ Returns: Rendered equation image
```

### Performance Monitoring Utilities

```
performance_monitoring module
â”œâ”€â”€ Classes:
â”‚   â””â”€â”€ PerformanceMonitor
â”‚       â”œâ”€â”€ Attributes:
â”‚       â”‚   â”œâ”€â”€ metrics: Dict[str, List[float]]
â”‚       â”‚   â””â”€â”€ start_times: Dict[str, float]
â”‚       â”œâ”€â”€ Methods:
â”‚       â”‚   â”œâ”€â”€ start_timer(name: str) -> None
â”‚       â”‚   â”œâ”€â”€ stop_timer(name: str) -> float
â”‚       â”‚   â”œâ”€â”€ record_metric(name: str, value: float) -> None
â”‚       â”‚   â”œâ”€â”€ get_average(name: str) -> float
â”‚       â”‚   â”œâ”€â”€ get_percentile(name: str, percentile: float) -> float
â”‚       â”‚   â””â”€â”€ get_summary() -> Dict[str, Any]
â”‚
â”œâ”€â”€ Decorators:
â”‚   â”œâ”€â”€ @time_function
â”‚   â”‚   â””â”€â”€ Measures function execution time
â”‚   â””â”€â”€ @log_performance
â”‚       â””â”€â”€ Logs performance metrics

recommendation_metrics module
â”œâ”€â”€ Functions:
â”‚   â”œâ”€â”€ precision_at_k(predictions, ground_truth, k) -> float
â”‚   â”œâ”€â”€ recall_at_k(predictions, ground_truth, k) -> float
â”‚   â”œâ”€â”€ ndcg_at_k(predictions, ground_truth, k) -> float
â”‚   â”œâ”€â”€ mean_average_precision(predictions, ground_truth) -> float
â”‚   â””â”€â”€ hit_rate_at_k(predictions, ground_truth, k) -> float
```

---


## ML Monitoring Architecture

The ML monitoring layer provides observability for machine learning models and predictions.

```
PredictionMonitor
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ predictions: List[Dict[str, Any]]
â”‚   â”œâ”€â”€ metrics: Dict[str, float]
â”‚   â””â”€â”€ alert_thresholds: Dict[str, float]
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ __init__()
â”‚   â”œâ”€â”€ log_prediction(model_name, input_data, prediction, confidence, latency_ms) -> None
â”‚   â”œâ”€â”€ get_metrics(window_minutes: int) -> Dict[str, Any]
â”‚   â”œâ”€â”€ get_prediction_distribution() -> Dict[str, int]
â”‚   â”œâ”€â”€ get_average_confidence() -> float
â”‚   â”œâ”€â”€ get_average_latency() -> float
â”‚   â”œâ”€â”€ check_drift(baseline_distribution) -> bool
â”‚   â””â”€â”€ export_metrics() -> Dict[str, Any]

AlertManager
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ alerts: List[Alert]
â”‚   â””â”€â”€ notification_channels: List[NotificationChannel]
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ __init__()
â”‚   â”œâ”€â”€ create_alert(alert_type, severity, message, metadata) -> Alert
â”‚   â”œâ”€â”€ check_thresholds(metrics: Dict[str, float]) -> List[Alert]
â”‚   â”œâ”€â”€ send_notification(alert: Alert) -> None
â”‚   â””â”€â”€ get_active_alerts() -> List[Alert]

HealthCheck
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ check_model_health(model_name: str) -> Dict[str, Any]
â”‚   â”œâ”€â”€ check_database_health() -> Dict[str, Any]
â”‚   â”œâ”€â”€ check_service_health(service_name: str) -> Dict[str, Any]
â”‚   â””â”€â”€ get_system_health() -> Dict[str, Any]

JSONLogging
â”œâ”€â”€ Functions:
â”‚   â”œâ”€â”€ setup_json_logging(log_level: str) -> None
â”‚   â”œâ”€â”€ log_structured(level, message, **kwargs) -> None
â”‚   â””â”€â”€ get_logger(name: str) -> logging.Logger
```

---

## Schema Layer Architecture

The schema layer defines Pydantic models for API request/response validation.

```
SearchQuery (Pydantic)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ text: str
â”‚   â”œâ”€â”€ limit: int = 20
â”‚   â”œâ”€â”€ offset: int = 0
â”‚   â”œâ”€â”€ hybrid_weight: float = 0.5
â”‚   â”œâ”€â”€ filters: Optional[SearchFilters]
â”‚   â””â”€â”€ sort_by: Optional[str]

SearchFilters (Pydantic)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ classification_code: Optional[List[str]]
â”‚   â”œâ”€â”€ type: Optional[List[str]]
â”‚   â”œâ”€â”€ language: Optional[List[str]]
â”‚   â”œâ”€â”€ year_min: Optional[int]
â”‚   â””â”€â”€ year_max: Optional[int]

ResourceCreate (Pydantic)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ title: str
â”‚   â”œâ”€â”€ description: Optional[str]
â”‚   â”œâ”€â”€ creator: Optional[str]
â”‚   â”œâ”€â”€ subject: Optional[List[str]]
â”‚   â”œâ”€â”€ type: str
â”‚   â”œâ”€â”€ language: str
â”‚   â””â”€â”€ identifier: str

ResourceUpdate (Pydantic)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ title: Optional[str]
â”‚   â”œâ”€â”€ description: Optional[str]
â”‚   â”œâ”€â”€ creator: Optional[str]
â”‚   â”œâ”€â”€ subject: Optional[List[str]]
â”‚   â””â”€â”€ classification_code: Optional[str]

ClassifyRequest (Pydantic)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ text: str
â”‚   â””â”€â”€ top_k: int = 5

AnnotationCreate (Pydantic)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ resource_id: UUID
â”‚   â”œâ”€â”€ content: str
â”‚   â”œâ”€â”€ annotation_type: str
â”‚   â”œâ”€â”€ start_position: Optional[int]
â”‚   â”œâ”€â”€ end_position: Optional[int]
â”‚   â””â”€â”€ tags: Optional[List[str]]

RecommendationRequest (Pydantic)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ user_id: str
â”‚   â”œâ”€â”€ limit: int = 10
â”‚   â””â”€â”€ strategy: str = "hybrid"
```

---


## Configuration Layer Architecture

The configuration layer manages application settings and environment variables.

```
Settings (Pydantic BaseSettings)
â”œâ”€â”€ Attributes:
â”‚   â”œâ”€â”€ DATABASE_URL: str
â”‚   â”œâ”€â”€ SECRET_KEY: str
â”‚   â”œâ”€â”€ API_VERSION: str = "v2.0"
â”‚   â”œâ”€â”€ DEBUG: bool = False
â”‚   â”œâ”€â”€ LOG_LEVEL: str = "INFO"
â”‚   â”œâ”€â”€ CORS_ORIGINS: List[str]
â”‚   â”œâ”€â”€ MAX_UPLOAD_SIZE: int
â”‚   â”œâ”€â”€ EMBEDDING_MODEL: str = "sentence-transformers/all-MiniLM-L6-v2"
â”‚   â”œâ”€â”€ CLASSIFICATION_MODEL: str = "distilbert-base-uncased"
â”‚   â”œâ”€â”€ ENABLE_GPU: bool = True
â”‚   â”œâ”€â”€ CACHE_TTL: int = 3600
â”‚   â””â”€â”€ RATE_LIMIT: int = 100
â”œâ”€â”€ Methods:
â”‚   â”œâ”€â”€ get_database_url() -> str
â”‚   â”œâ”€â”€ is_production() -> bool
â”‚   â””â”€â”€ validate_settings() -> None

get_settings()
â”œâ”€â”€ Returns: Settings (singleton)
â””â”€â”€ Usage: settings = get_settings()
```

---

## Complete System Flow Diagrams

### Classification Flow

```
User Request
    â†“
FastAPI Router (POST /api/classification/classify)
    â†“
MLClassificationService.predict(text, top_k)
    â†“
    â”œâ”€â†’ _load_model() [if not loaded]
    â”‚   â”œâ”€â†’ _import_ml_libraries()
    â”‚   â”œâ”€â†’ _load_tokenizer()
    â”‚   â”œâ”€â†’ _determine_checkpoint_path()
    â”‚   â”œâ”€â†’ _load_model_from_checkpoint()
    â”‚   â””â”€â†’ _move_model_to_device()
    â”‚
    â”œâ”€â†’ Tokenize input text
    â”œâ”€â†’ Model inference (forward pass)
    â”œâ”€â†’ Apply sigmoid activation
    â”œâ”€â†’ Sort by confidence
    â”œâ”€â†’ Take top_k predictions
    â”‚
    â””â”€â†’ Create ClassificationResult domain object
        â”œâ”€â†’ ClassificationPrediction objects
        â””â”€â†’ Validate all predictions
    â†“
PredictionMonitor.log_prediction()
    â†“
Return ClassificationResult
    â†“
Convert to JSON response
    â†“
User receives predictions
```

### Quality Assessment Flow

```
User Request
    â†“
FastAPI Router (POST /api/quality/compute/{resource_id})
    â†“
QualityService.compute_quality(resource_id, weights)
    â†“
    â”œâ”€â†’ Validate weights
    â”œâ”€â†’ Query Resource from database
    â”‚
    â”œâ”€â†’ _compute_accuracy_dimension(resource)
    â”œâ”€â†’ _compute_completeness_dimension(resource)
    â”œâ”€â†’ _compute_consistency_dimension(resource)
    â”œâ”€â†’ _compute_timeliness_dimension(resource)
    â””â”€â†’ _compute_relevance_dimension(resource)
    â†“
Create QualityScore domain object
    â”œâ”€â†’ Validate all dimensions (0.0-1.0)
    â””â”€â†’ Calculate overall_score()
    â†“
_update_resource_quality_fields(resource, ...)
    â†“
Database commit
    â†“
Return QualityScore
    â†“
Convert to JSON response
    â†“
User receives quality assessment
```


### Recommendation Flow (Strategy Pattern)

```
User Request
    â†“
FastAPI Router (GET /api/recommendations/user/{user_id})
    â†“
generate_recommendations(db, resource_id, limit, strategy, user_id)
    â†“
RecommendationStrategyFactory.create(strategy_type, db)
    â†“
    â”œâ”€â†’ strategy="collaborative" â†’ CollaborativeFilteringStrategy
    â”œâ”€â†’ strategy="content" â†’ ContentBasedStrategy
    â”œâ”€â†’ strategy="graph" â†’ GraphBasedStrategy
    â””â”€â†’ strategy="hybrid" â†’ HybridStrategy
    â†“
Strategy.generate(user_id, limit)
    â†“
    [CollaborativeFilteringStrategy]
    â”œâ”€â†’ _build_user_item_matrix()
    â”œâ”€â†’ Compute user similarities
    â”œâ”€â†’ Generate predictions
    â””â”€â†’ Create Recommendation objects
    
    [ContentBasedStrategy]
    â”œâ”€â†’ Query UserInteraction
    â”œâ”€â†’ _build_user_profile(interactions)
    â”œâ”€â†’ Query Resources with embeddings
    â”œâ”€â†’ _compute_similarity(profile, embedding)
    â””â”€â†’ Create Recommendation objects
    
    [GraphBasedStrategy]
    â”œâ”€â†’ _traverse_citation_network(resource_id, depth)
    â”œâ”€â†’ Score by citation distance
    â””â”€â†’ Create Recommendation objects
    
    [HybridStrategy]
    â”œâ”€â†’ Execute all sub-strategies
    â”œâ”€â†’ _merge_recommendations(results, weights)
    â””â”€â†’ Create Recommendation objects
    â†“
Return List[Recommendation]
    â†“
Convert to List[Dict] for API compatibility
    â†“
User receives recommendations
```

### Search Flow (Three-Way Hybrid)

```
User Request
    â†“
FastAPI Router (POST /api/search/three-way)
    â†“
HybridSearchQuery(db, query, enable_reranking, adaptive_weights)
    â†“
execute()
    â†“
    â”œâ”€â†’ _ensure_tables_exist()
    â”œâ”€â†’ _check_services_available()
    â”œâ”€â†’ _analyze_query() â†’ query characteristics
    â”‚
    â”œâ”€â†’ PHASE 1: _execute_retrieval_phase()
    â”‚   â”œâ”€â†’ _search_fts5() â†’ FTS5 keyword results
    â”‚   â”œâ”€â†’ _search_dense() â†’ Dense vector results
    â”‚   â””â”€â†’ _search_sparse() â†’ Sparse vector results
    â”‚   â””â”€â†’ Return RetrievalCandidates
    â”‚
    â”œâ”€â†’ PHASE 2: _execute_fusion_phase(candidates)
    â”‚   â”œâ”€â†’ _compute_weights() â†’ adaptive RRF weights
    â”‚   â”œâ”€â†’ ReciprocalRankFusionService.fuse_results()
    â”‚   â”œâ”€â†’ _compute_method_contributions()
    â”‚   â””â”€â†’ Return FusedCandidates
    â”‚
    â”œâ”€â†’ PHASE 3: _execute_reranking_phase(fused)
    â”‚   â”œâ”€â†’ RerankingService.rerank() [if enabled]
    â”‚   â””â”€â†’ Return final ranked results
    â”‚
    â”œâ”€â†’ _fetch_paginated_resources(results)
    â”œâ”€â†’ _compute_facets(results)
    â””â”€â†’ _generate_snippets(resources)
    â†“
Return (resources, total, facets, snippets, metadata)
    â†“
Convert to JSON response
    â†“
User receives search results
```


### Refactoring Detection Flow

```
Developer runs CLI
    â†“
refactoring.cli.detect_smells(directory_path)
    â†“
CodeSmellDetector()
    â”œâ”€â†’ Initialize validators:
    â”‚   â”œâ”€â†’ FunctionLengthChecker()
    â”‚   â”œâ”€â†’ ClassSizeChecker()
    â”‚   â”œâ”€â†’ TypeHintCoverageChecker()
    â”‚   â””â”€â†’ CodeDuplicationDetector()
    â†“
analyze_directory(dir_path)
    â†“
    For each Python file:
    â”œâ”€â†’ analyze_file(file_path)
    â”‚   â”œâ”€â†’ FunctionLengthChecker.check_file()
    â”‚   â”‚   â”œâ”€â†’ Parse AST
    â”‚   â”‚   â”œâ”€â†’ _extract_functions()
    â”‚   â”‚   â”œâ”€â†’ _analyze_function()
    â”‚   â”‚   â””â”€â†’ _create_smell() if violation
    â”‚   â”‚
    â”‚   â”œâ”€â†’ ClassSizeChecker.check_file()
    â”‚   â”‚   â”œâ”€â†’ Parse AST
    â”‚   â”‚   â”œâ”€â†’ _extract_classes()
    â”‚   â”‚   â”œâ”€â†’ _analyze_class()
    â”‚   â”‚   â””â”€â†’ _create_smell() if violation
    â”‚   â”‚
    â”‚   â”œâ”€â†’ TypeHintCoverageChecker.check_file()
    â”‚   â”‚   â”œâ”€â†’ Parse AST
    â”‚   â”‚   â”œâ”€â†’ _has_complete_type_hints()
    â”‚   â”‚   â””â”€â†’ _create_smell() if missing
    â”‚   â”‚
    â”‚   â”œâ”€â†’ _detect_feature_envy()
    â”‚   â”œâ”€â†’ _detect_long_parameter_lists()
    â”‚   â”œâ”€â†’ _count_lines()
    â”‚   â””â”€â†’ _calculate_complexity()
    â”‚   â†“
    â”‚   Return SmellReport
    â”‚
    â””â”€â†’ CodeDuplicationDetector.check_files(all_files)
        â”œâ”€â†’ _extract_function_bodies()
        â”œâ”€â†’ Compare all pairs
        â”œâ”€â†’ _calculate_similarity()
        â””â”€â†’ _create_smell() if duplicate
    â†“
prioritize_smells(reports)
    â”œâ”€â†’ Sort by severity (HIGH, MEDIUM, LOW)
    â””â”€â†’ Return PrioritizedSmells
    â†“
generate_summary_report(reports)
    â†“
Display results to developer
```

---

## Design Patterns Used

### Domain-Driven Design (DDD)
- **Value Objects**: ClassificationPrediction, QualityScore, RecommendationScore, SearchQuery
- **Entities**: Resource, TaxonomyNode, User (via entity_id)
- **Domain Services**: Classification, Quality, Recommendation, Search domains
- **Validation**: Encapsulated in domain objects with validate() methods

### Strategy Pattern
- **Context**: RecommendationService
- **Strategy Interface**: RecommendationStrategy (ABC)
- **Concrete Strategies**: CollaborativeFilteringStrategy, ContentBasedStrategy, GraphBasedStrategy, HybridStrategy
- **Factory**: RecommendationStrategyFactory

### Factory Pattern
- **RecommendationStrategyFactory**: Creates strategy instances based on type
- **SessionLocal**: Creates database session instances

### Repository Pattern
- **Database Models**: Act as repositories for domain entities
- **Service Layer**: Abstracts database operations from business logic

### Dependency Injection
- **FastAPI Dependencies**: get_db() provides database sessions
- **Service Constructors**: Accept db: Session parameter

### Observer Pattern
- **PredictionMonitor**: Observes and logs ML predictions
- **AlertManager**: Observes metrics and triggers alerts

### Command Query Separation (CQS)
- **Query Methods**: get_*, compute_*, analyze_* (no side effects)
- **Command Methods**: create_*, update_*, delete_* (modify state)

### Builder Pattern
- **SearchQuery**: Builds complex search queries with optional parameters
- **ClassificationResult**: Builds results with predictions and metadata

---


## Key Architectural Principles

### 1. Separation of Concerns
- **Domain Layer**: Pure business logic, no infrastructure dependencies
- **Service Layer**: Orchestrates domain objects and infrastructure
- **Router Layer**: HTTP concerns only, delegates to services
- **Database Layer**: Data persistence only

### 2. Dependency Inversion
- High-level modules (services) don't depend on low-level modules (database)
- Both depend on abstractions (domain objects, interfaces)
- Database sessions injected via dependency injection

### 3. Single Responsibility
- Each class has one reason to change
- Domain objects: Represent business concepts
- Services: Implement business operations
- Validators: Check specific code quality aspects
- Routers: Handle HTTP requests/responses

### 4. Open/Closed Principle
- Open for extension: New strategies can be added without modifying existing code
- Closed for modification: Core abstractions remain stable
- Example: Adding new RecommendationStrategy doesn't change RecommendationService

### 5. Liskov Substitution
- All RecommendationStrategy implementations are interchangeable
- All ValueObject subclasses can be used polymorphically
- Domain objects can be substituted without breaking contracts

### 6. Interface Segregation
- Small, focused interfaces (RecommendationStrategy has one method)
- Clients depend only on methods they use
- No fat interfaces with unused methods

### 7. Don't Repeat Yourself (DRY)
- Common validation logic in base classes (BaseDomainObject)
- Shared utilities in utility layer
- Reusable validators in refactoring framework

### 8. Composition Over Inheritance
- HybridStrategy composes multiple strategies
- Services compose domain objects
- Minimal inheritance hierarchies

---

## Testing Architecture

### Unit Tests
```
test_domain_*.py
â”œâ”€â”€ Test domain object validation
â”œâ”€â”€ Test domain object methods
â”œâ”€â”€ Test value object immutability
â””â”€â”€ No database or external dependencies

test_*_service.py
â”œâ”€â”€ Test service methods with mocked database
â”œâ”€â”€ Test business logic
â”œâ”€â”€ Test error handling
â””â”€â”€ Use pytest fixtures for setup

test_refactoring_*.py
â”œâ”€â”€ Test code smell detection
â”œâ”€â”€ Test validators
â”œâ”€â”€ Test AST parsing
â””â”€â”€ Use sample code files
```

### Integration Tests
```
test_*_integration.py
â”œâ”€â”€ Test service + database interactions
â”œâ”€â”€ Test API endpoints
â”œâ”€â”€ Use test database
â””â”€â”€ Test complete workflows
```

### Test Fixtures
```
conftest.py
â”œâ”€â”€ @pytest.fixture: db_session
â”œâ”€â”€ @pytest.fixture: test_client
â”œâ”€â”€ @pytest.fixture: sample_resources
â””â”€â”€ @pytest.fixture: mock_ml_model
```

---

## Performance Considerations

### Lazy Loading
- ML models loaded on first use (MLClassificationService._load_model)
- Reduces startup time and memory usage

### Caching
- Model checkpoints cached on disk
- Embeddings cached in database
- Query results can be cached (future enhancement)

### Batch Processing
- predict_batch() for multiple classifications
- Batch quality outlier detection
- Vectorized operations in numpy

### Database Optimization
- Indexes on frequently queried fields (id, resource_id, user_id)
- JSON fields for flexible metadata
- Pagination for large result sets

### Async Operations
- FastAPI async endpoints (future enhancement)
- Background tasks for long-running operations
- Async database queries (future enhancement)

---

## Security Considerations

### Input Validation
- Pydantic schemas validate all API inputs
- Domain objects validate business rules
- SQL injection prevented by SQLAlchemy ORM

### Authentication & Authorization
- JWT tokens for API authentication (future enhancement)
- Role-based access control (future enhancement)
- Resource ownership validation

### Data Privacy
- User data anonymization options
- GDPR compliance considerations
- Audit logging for sensitive operations

---

## Deployment Architecture

```
Production Environment
â”œâ”€â”€ Load Balancer
â”‚   â””â”€â”€ Distributes traffic across instances
â”œâ”€â”€ Application Servers (multiple instances)
â”‚   â”œâ”€â”€ FastAPI application
â”‚   â”œâ”€â”€ Gunicorn workers
â”‚   â””â”€â”€ ML models loaded in memory
â”œâ”€â”€ Database Server
â”‚   â”œâ”€â”€ PostgreSQL (production)
â”‚   â””â”€â”€ SQLite (development)
â”œâ”€â”€ Cache Layer
â”‚   â””â”€â”€ Redis (future enhancement)
â””â”€â”€ Monitoring
    â”œâ”€â”€ Prometheus metrics
    â”œâ”€â”€ Grafana dashboards
    â””â”€â”€ Alert notifications
```

---

## Future Enhancements

### Planned Features
1. **Async Operations**: Convert services to async for better concurrency
2. **Caching Layer**: Add Redis for query result caching
3. **GraphQL API**: Alternative to REST for flexible queries
4. **Real-time Updates**: WebSocket support for live notifications
5. **Advanced ML**: Add more sophisticated models (BERT, GPT)
6. **Distributed Training**: Multi-GPU and distributed model training
7. **A/B Testing**: Framework for testing recommendation strategies
8. **Explainability**: Add SHAP/LIME for model interpretability

### Technical Debt
1. Complete async conversion of database operations
2. Add comprehensive API documentation (OpenAPI/Swagger)
3. Implement rate limiting and throttling
4. Add request/response compression
5. Implement circuit breakers for external services
6. Add distributed tracing (OpenTelemetry)

---

## Conclusion

This architecture diagram provides a complete view of the Neo Alexandria 2.0 system, showing:

- **Clear separation of concerns** across layers
- **Domain-Driven Design** with rich domain objects
- **Design patterns** (Strategy, Factory, Repository, etc.)
- **Comprehensive service layer** with business logic
- **Robust refactoring framework** for code quality
- **Complete data flow** from request to response
- **Testing strategy** for reliability
- **Performance optimizations** for scalability
- **Security considerations** for production readiness

The architecture is designed to be:
- **Maintainable**: Clear structure and separation of concerns
- **Extensible**: Easy to add new features and strategies
- **Testable**: Isolated components with clear interfaces
- **Scalable**: Stateless services that can be horizontally scaled
- **Reliable**: Comprehensive error handling and monitoring

For specific implementation details, refer to the individual module documentation and inline code comments.


---

## Phase 12 and Complete System Overview

For detailed Phase 12 (Fowler Refactoring Framework) diagrams and the complete system overview with performance metrics, see:

**[ARCHITECTURE_PHASE12.md](./ARCHITECTURE_PHASE12.md)**

This supplementary document includes:
- Phase 12 refactoring framework architecture
- Complete system overview diagram
- Full request lifecycle data flow
- Cross-cutting concerns
- Design patterns summary
- Performance metrics and characteristics



---

## Phase 12.5: Event-Driven Architecture

### Event-Driven System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EVENT-DRIVEN ARCHITECTURE (Phase 12.5)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         Event System Core                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚                     EventEmitter (Singleton)                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ on(event_type, handler) - Register listener               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ off(event_type, handler) - Unregister listener            â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ emit(event_type, data, priority) - Dispatch event         â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ get_event_history(limit) - Retrieve event log             â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚                    SystemEvent Enum                          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Resource: created, updated, deleted, content_changed        â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Processing: ingestion, embedding, quality, classification   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  User: interaction_tracked, profile_updated                  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  System: cache_invalidated, search_index_updated             â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Celery Distributed Task Queue                    â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚    Redis     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”¤ Celery App   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Workers   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚   (Broker)   â”‚        â”‚  (celery_app)â”‚         â”‚  (4x nodes) â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                 â”‚                                   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚                        Task Routing                           â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ urgent queue (priority 9) - Search index, cache            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ high_priority queue (priority 7) - Embeddings              â”‚  â”‚    â”‚ 
â”‚  â”‚  â”‚  â€¢ ml_tasks queue (priority 5) - Classification, quality      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ batch queue (priority 3) - Batch processing                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ default queue (priority 5) - General tasks                 â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      Event Hooks (Auto-Consistency)                 â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  resource.content_changed â”€â”€â–º regenerate_embedding_task (5s delay)  â”‚    â”‚
â”‚  â”‚  resource.metadata_changed â”€â–º recompute_quality_task (10s delay)    â”‚    â”‚
â”‚  â”‚  resource.updated â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º update_search_index_task (1s delay)   â”‚    â”‚
â”‚  â”‚  citations.extracted â”€â”€â”€â”€â”€â”€â”€â”€â–º update_graph_edges_task (30s delay)  â”‚    â”‚
â”‚  â”‚  resource.updated â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º invalidate_cache_task (immediate)     â”‚    â”‚
â”‚  â”‚  user.interaction_tracked â”€â”€â”€â–º refresh_profile_task (every 10)      â”‚    â”‚
â”‚  â”‚  resource.created â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º classify_resource_task (20s delay)   â”‚    â”‚
â”‚  â”‚  authors.extracted â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º normalize_names_task (60s delay)     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Celery Task Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CELERY TASK HIERARCHY                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                        â”‚  DatabaseTask    â”‚                                 â”‚
â”‚                        â”‚  (Base Class)    â”‚                                 â”‚
â”‚                        â”‚  â€¢ __call__()    â”‚                                 â”‚
â”‚                        â”‚  â€¢ Session mgmt  â”‚                                 â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                 â”‚                                           â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚         â”‚                       â”‚                       â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ regenerate_     â”‚   â”‚ recompute_       â”‚   â”‚ update_search_   â”‚          â”‚
â”‚  â”‚ embedding_task  â”‚   â”‚ quality_task     â”‚   â”‚ index_task       â”‚          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚  â”‚ â€¢ max_retries=3 â”‚   â”‚ â€¢ max_retries=2  â”‚   â”‚ â€¢ priority=9     â”‚          â”‚
â”‚  â”‚ â€¢ retry_delay=60â”‚   â”‚ â€¢ priority=5     â”‚   â”‚ â€¢ max_retries=3  â”‚          â”‚
â”‚  â”‚ â€¢ priority=7    â”‚   â”‚ â€¢ countdown=10   â”‚   â”‚ â€¢ countdown=1    â”‚          â”‚
â”‚  â”‚ â€¢ countdown=5   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ update_graph_    â”‚   â”‚ classify_        â”‚   â”‚ invalidate_      â”‚         â”‚
â”‚  â”‚ edges_task       â”‚   â”‚ resource_task    â”‚   â”‚ cache_task       â”‚         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  â”‚ â€¢ priority=5     â”‚   â”‚ â€¢ max_retries=2  â”‚   â”‚ â€¢ priority=9     â”‚         â”‚
â”‚  â”‚ â€¢ countdown=30   â”‚   â”‚ â€¢ priority=5     â”‚   â”‚ â€¢ countdown=0    â”‚         â”‚
â”‚  â”‚ â€¢ batch_delay    â”‚   â”‚ â€¢ countdown=20   â”‚   â”‚ â€¢ pattern supportâ”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ refresh_         â”‚   â”‚ batch_process_resources_task             â”‚        â”‚
â”‚  â”‚ recommendation_  â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚ profile_task     â”‚   â”‚ â€¢ Progress tracking with update_state()  â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚ â€¢ Operations: regenerate_embeddings,     â”‚        â”‚
â”‚  â”‚ â€¢ priority=3     â”‚   â”‚   recompute_quality                      â”‚        â”‚
â”‚  â”‚ â€¢ countdown=300  â”‚   â”‚ â€¢ Returns: processed_count, status       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Redis Caching Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MULTI-LAYER REDIS CACHING                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         RedisCache Class                            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  Methods:                                                    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ get(key) â†’ value | None                                   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ set(key, value, ttl) â†’ None                               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ delete(key) â†’ None                                        â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ delete_pattern(pattern) â†’ int (count)                     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ get_default_ttl(key) â†’ int (seconds)                      â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚                    CacheStats Tracking                       â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ hits: int                                                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ misses: int                                               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ invalidations: int                                        â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ hit_rate() â†’ float (0.0-1.0)                              â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        Cache Key Strategy                           â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  embedding:{resource_id}           TTL: 3600s (1 hour)              â”‚    â”‚
â”‚  â”‚  quality:{resource_id}             TTL: 1800s (30 minutes)          â”‚    â”‚
â”‚  â”‚  search_query:{hash}               TTL: 300s (5 minutes)            â”‚    â”‚
â”‚  â”‚  resource:{resource_id}            TTL: 600s (10 minutes)           â”‚    â”‚
â”‚  â”‚  graph:{resource_id}:neighbors     TTL: 1800s (30 minutes)          â”‚    â”‚
â”‚  â”‚  user:{user_id}:profile            TTL: 600s (10 minutes)           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Cache Invalidation Patterns                      â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  resource:{resource_id}:*          â†’ All resource-related caches    â”‚    â”‚
â”‚  â”‚  search_query:*                    â†’ All search result caches       â”‚    â”‚
â”‚  â”‚  graph:*                           â†’ All graph caches               â”‚    â”‚
â”‚  â”‚  user:{user_id}:*                  â†’ All user-related caches        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Service Integration with Events

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVICE LAYER EVENT INTEGRATION                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                       ResourceService                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  create(data) â†’ Resource                                     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    1. Create resource in database                            â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    2. Emit: resource.created                                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    3. Hooks trigger: classify_resource_task                  â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  update(id, data) â†’ Resource                                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    1. Update resource in database                            â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    2. Detect changes (content vs metadata)                   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    3. Emit: resource.updated                                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    4. Emit: resource.content_changed (if content changed)    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    5. Emit: resource.metadata_changed (if metadata changed)  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    6. Hooks trigger:                                         â”‚   â”‚    â”‚
â”‚  â”‚  â”‚       - regenerate_embedding_task (if content)               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚       - recompute_quality_task (if metadata)                 â”‚   â”‚    â”‚
â”‚  â”‚  â”‚       - update_search_index_task (always)                    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚       - invalidate_cache_task (always)                       â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      IngestionService                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  process(url) â†’ Resource                                     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    1. Emit: ingestion.started                                â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    2. Fetch and extract content                              â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    3. Generate embeddings                                    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    4. Extract citations â†’ Emit: citations.extracted          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    5. Extract authors â†’ Emit: authors.extracted              â”‚   â”‚    â”‚ 
â”‚  â”‚  â”‚    6. Compute quality                                        â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    7. Create resource â†’ Emit: resource.created               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    8. Emit: ingestion.completed                              â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    9. Hooks trigger all downstream tasks                     â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   UserInteractionTracking                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  track_interaction(user_id, resource_id, type) â†’ None        â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    1. Record interaction in database                         â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    2. Get total interaction count for user                   â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    3. Emit: user.interaction_tracked                         â”‚   â”‚    â”‚
â”‚  â”‚  â”‚    4. Hook checks: if count % 10 == 0                        â”‚   â”‚    â”‚
â”‚  â”‚  â”‚       â†’ refresh_recommendation_profile_task                  â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Docker Compose Service Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DOCKER COMPOSE ORCHESTRATION                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                            Redis                                    â”‚    â”‚
â”‚  â”‚  â€¢ Image: redis:7-alpine                                            â”‚    â”‚
â”‚  â”‚  â€¢ Memory: 2GB with allkeys-lru eviction                            â”‚    â”‚
â”‚  â”‚  â€¢ Persistence: appendonly yes                                      â”‚    â”‚
â”‚  â”‚  â€¢ Port: 6379                                                       â”‚    â”‚
â”‚  â”‚  â€¢ Health check: redis-cli ping                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                   â”‚                                         â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚              â”‚              â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Celery Workers    â”‚  â”‚  Celery Beat    â”‚  â”‚     Flower          â”‚       â”‚
â”‚  â”‚  (4 replicas)      â”‚  â”‚  (Scheduler)    â”‚  â”‚   (Monitoring)      â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚ â€¢ Concurrency: 4   â”‚  â”‚ â€¢ Schedules:    â”‚  â”‚ â€¢ Port: 5555        â”‚       â”‚
â”‚  â”‚ â€¢ CPU: 2 cores     â”‚  â”‚   - Daily 2 AM  â”‚  â”‚ â€¢ Web dashboard     â”‚       â”‚
â”‚  â”‚ â€¢ Memory: 2GB      â”‚  â”‚   - Weekly Sun  â”‚  â”‚ â€¢ Task monitoring   â”‚       â”‚
â”‚  â”‚ â€¢ Queues: all      â”‚  â”‚   - Monthly 1st â”‚  â”‚ â€¢ Worker stats      â”‚       â”‚
â”‚  â”‚ â€¢ Auto-restart     â”‚  â”‚   - Daily 4 AM  â”‚  â”‚ â€¢ Real-time graphs  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         FastAPI Application                         â”‚    â”‚
â”‚  â”‚  â€¢ Depends on: Redis                                                â”‚    â”‚
â”‚  â”‚  â€¢ Environment: CELERY_BROKER_URL, CELERY_RESULT_BACKEND            â”‚    â”‚
â”‚  â”‚  â€¢ Startup: register_all_hooks(), initialize Redis cache            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Flow: Resource Update with Event Cascade

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RESOURCE UPDATE EVENT CASCADE (Phase 12.5)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1. API Request: PUT /resources/{id}                                        â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  2. ResourceService.update(id, data)                                        â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â–º Update database                                                     â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â–º Detect changes: content_changed = True, metadata_changed = False    â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â–º Emit: resource.updated                                              â”‚
â”‚     â”‚   â””â”€â–º Hook: on_resource_updated_sync_search_index                     â”‚
â”‚     â”‚       â””â”€â–º Queue: update_search_index_task (priority=9, countdown=1s)  â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â–º Emit: resource.updated                                              â”‚
â”‚     â”‚   â””â”€â–º Hook: on_resource_updated_invalidate_caches                     â”‚
â”‚     â”‚       â””â”€â–º Queue: invalidate_cache_task (priority=9, countdown=0s)     â”‚
â”‚     â”‚           â””â”€â–º Invalidate: resource:{id}:*, search_query:*             â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â””â”€â–º Emit: resource.content_changed                                      â”‚
â”‚         â””â”€â–º Hook: on_content_changed_regenerate_embedding                   â”‚
â”‚             â””â”€â–º Queue: regenerate_embedding_task (priority=7, countdown=5s) â”‚
â”‚                 â””â”€â–º Generate embedding â†’ Store in cache                     â”‚
â”‚                                                                             â”‚
â”‚  3. Celery Workers Process Tasks (in parallel)                              â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â–º Worker 1: update_search_index_task (1s delay)                       â”‚
â”‚     â”‚   â””â”€â–º Update FTS5 index â†’ Resource searchable                         â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â–º Worker 2: invalidate_cache_task (immediate)                         â”‚
â”‚     â”‚   â””â”€â–º Delete cache keys â†’ Fresh data on next request                  â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â””â”€â–º Worker 3: regenerate_embedding_task (5s delay)                      â”‚
â”‚         â””â”€â–º Generate embedding â†’ Cache â†’ Enable semantic search             â”‚
â”‚                                                                             â”‚
â”‚  4. All tasks complete within 10 seconds                                    â”‚
â”‚     â””â”€â–º Resource fully updated and consistent across all systems            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Performance Characteristics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PHASE 12.5 PERFORMANCE METRICS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Scalability:                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â€¢ 100+ concurrent ingestions without degradation                   â”‚    â”‚
â”‚  â”‚  â€¢ Linear throughput scaling with worker count                      â”‚    â”‚
â”‚  â”‚  â€¢ Horizontal scaling across multiple machines                      â”‚    â”‚
â”‚  â”‚  â€¢ 4 workers â†’ 400 tasks/minute                                     â”‚    â”‚
â”‚  â”‚  â€¢ 8 workers â†’ 800 tasks/minute (linear)                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  Cache Performance:                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â€¢ 60-70% cache hit rate for repeated operations                    â”‚    â”‚
â”‚  â”‚  â€¢ 50-70% computation reduction through caching                     â”‚    â”‚
â”‚  â”‚  â€¢ Sub-millisecond cache lookups                                    â”‚    â”‚
â”‚  â”‚  â€¢ Pattern-based invalidation in <10ms                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  Task Reliability:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â€¢ <1% task failure rate with automatic retries                     â”‚    â”‚
â”‚  â”‚  â€¢ Exponential backoff for transient errors                         â”‚    â”‚
â”‚  â”‚  â€¢ Dead letter queue for permanent failures                         â”‚    â”‚
â”‚  â”‚  â€¢ Task acknowledgment after completion                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  Search Index Updates:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â€¢ Complete within 5 seconds of resource updates                    â”‚    â”‚
â”‚  â”‚  â€¢ URGENT priority ensures immediate searchability                  â”‚    â”‚
â”‚  â”‚  â€¢ Automatic retry on failure                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  Database Connection Pooling:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â€¢ 20 base connections + 40 overflow = 60 total                     â”‚    â”‚
â”‚  â”‚  â€¢ Connection recycling after 1 hour                                â”‚    â”‚
â”‚  â”‚  â€¢ Pre-ping health checks                                           â”‚    â”‚
â”‚  â”‚  â€¢ Handles 100+ concurrent requests                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```



---

## Complete System Architecture - Layered View

### Neo Alexandria 2.0 - Full Stack Architecture (All Phases Integrated)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          LAYER 1: PRESENTATION                              â•‘
â•‘                  (FastAPI Routers)                                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  /api/resources      /api/search         /api/collections                   â•‘
â•‘  /api/taxonomy       /aotations    /api/recommendations                     â•‘
â•‘  /api/quality        /api/classification /api/monitoring                    â•‘
â•‘  /api/scholarly                                                             â•‘
â•‘                                                                             â•‘
â•‘  â€¢ Request lidation (Pydantic)                                              â•‘
â•‘  â€¢ Authentication & authorization                                           â•‘
â•‘  â€¢ Response serialization                                                   â•‘
â•‘  â€¢ OpenAPI documentation                                                    â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â”‚ HTTP Requests
                                    â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          LAYER 2: DOMAIN LAYER                              â•‘
â•‘                      (Phase 11: Domain-Driven Design)                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  Rich Domain Objects with Business Logic:                                   â•‘
â•‘                                                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
â•‘  â”‚ ResourceDomain  â”‚  â”‚  SearchDomain   â”‚  â”‚ QualityDomain   â”‚              â•‘
â•‘  â”‚ â€¢ validate()    â”‚  â”‚  â€¢ execute()    â”‚  â”‚  â€¢ compute()    â”‚              â•‘
â•‘  â”‚ â€¢ to_dict()     â”‚  â”‚  â€¢ to_dict()    â”‚  â”‚  â€¢ to_dict()    â”‚              â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
â•‘                                                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
â•‘  â”‚RecommendDomain  â”‚  â”‚ClassifyDomain   â”‚  â”‚AnnotationDomain â”‚              â•‘
â•‘  â”‚ â€¢ execute()     â”‚  â”‚  â€¢ predict()    â”‚  â”‚  â€¢ validate()   â”‚              â•‘
â•‘  â”‚ â€¢ to_dict()     â”‚  â”‚  â€¢ to_dict()    â”‚  â”‚  â€¢ to_dict()    â”‚              â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
â•‘                                                                             â•‘
â•‘  â€¢ Encapsulates business rules                                              â•‘
â•‘  â€¢ Independent of persistence                                               â•‘
â•‘  â€¢ Ubiquitous language                                                      â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â”‚ Business Logic
                                    â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          LAYER 3: SERVICE LAYER                             â•‘
â•‘                         (Core Business Services)                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  Core Services:                                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â•‘
â•‘  â”‚ ResourceService  â”‚  â”‚  SearchService   â”‚  â”‚ QualityService   â”‚           â•‘
â•‘  â”‚ â€¢ create()       â”‚  â”‚  â€¢ hybrid()      â”‚  â”‚  â€¢ compute()     â”‚           â•‘
â•‘  â”‚ â€¢ update()       â”‚  â”‚  â€¢ three_way()   â”‚  â”‚  â€¢ dimensions()  â”‚           â•‘
â•‘  â”‚ â€¢ delete()       â”‚  â”‚  â€¢ rerank()      â”‚  â”‚  â€¢ outliers()    â”‚           â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â•‘
â•‘                                                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â•‘
â•‘  â”‚RecommendService  â”‚  â”‚MLClassifyService â”‚  â”‚ EmbeddingService â”‚           â•‘
â•‘  â”‚ â€¢ get_similar()  â”‚  â”‚  â€¢ predict()     â”‚  â”‚  â€¢ generate()    â”‚           â•‘
â•‘  â”‚ â€¢ graph_based()  â”‚  â”‚  â€¢ fine_tune()   â”‚  â”‚  â€¢ batch()       â”‚           â•‘
â•‘  â”‚ â€¢ collaborative()â”‚  â”‚  â€¢ active_learn()â”‚  â”‚  â€¢ similarity()  â”‚           â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â•‘
â•‘                                                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â•‘
â•‘  â”‚ CitationService  â”‚  â”‚ TaxonomyService  â”‚  â”‚AnnotationService â”‚           â•‘
â•‘  â”‚ â€¢ extract()      â”‚  â”‚  â€¢ classify()    â”‚  â”‚  â€¢ create()      â”‚           â•‘
â•‘  â”‚ â€¢ parse()        â”‚  â”‚  â€¢ get_tree()    â”‚  â”‚  â€¢ update()      â”‚           â•‘
â•‘  â”‚ â€¢ graph_update() â”‚  â”‚  â€¢ suggest()     â”‚  â”‚  â€¢ by_resource() â”‚           â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â•‘
â•‘                                                                             â•‘
â•‘  â€¢ Orchestrates business operations                                         â•‘
â•‘  â€¢ Emits domain events                                                      â•‘
â•‘  â€¢ Transaction management                                                   â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â”‚ Event Emission
                                    â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                       LAYER 4: EVENT-DRIVEN LAYER                           â•‘
â•‘                      (Phase 12.5: Event System)                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  EventEmitter (Singleton):                                                  â•‘
â•‘  â€¢ on(event_type, handler)  - Register listeners                            â•‘
â•‘  â€¢ emit(event_type, data)   - Dispatch events                               â•‘
â•‘  â€¢ off(event_type, handler) - Unregister                                    â•‘
â•‘                                                                             â•‘
â•‘  Event Types:                                                               â•‘
â•‘  â€¢ resource.created, resource.updated, resource.deleted                     â•‘
â•‘  â€¢ resource.content_changed, resource.metadata_changed                      â•‘
â•‘  â€¢ ingestion_started, ingestion_completed                                   â•‘
â•‘  â€¢ classification_completed, quality_computed                               â•‘
â•‘  â€¢ user.interaction_tracked, cache_invalidated                              â•‘
â•‘                                                                             â•‘
â•‘  Event Hooks (Auto-Consistency):                                            â•‘
â•‘  resource.content_changed  â”€â”€â–º regenerate_embedding_task (5s, priority=7)   â•‘
â•‘  resource.metadata_changed â”€â”€â–º recompute_quality_task (10s, priority=5)     â•‘
â•‘  resource.updated          â”€â”€â–º update_search_index_task (1s, priority=9)    â•‘
â•‘  resource.updated          â”€â”€â–º invalidate_cache_task (immediate, priority=9)â•‘
â•‘  citations.extracted       â”€â”€â–º update_graph_edges_task (30s, priority=5)    â•‘
â•‘  user.interaction_tracked  â”€â”€â–º refresh_profile_task (every 10 interactions) â•‘
â•‘                                                                             â•‘
â•‘  â€¢ Loose coupling between components                                        â•‘
â•‘  â€¢ Asynchronous processing                                                  â•‘
â•‘  â€¢ Eventual consistency                                                     â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â”‚ Task Queue
                                    â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      LAYER 5: TASK PROCESSING LAYER                         â•‘
â•‘                          (Celery + Redis)                                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  Redis Message Broker:                                                      â•‘
â•‘  â€¢ Task queue management                                                    â•‘
â•‘  â€¢ Result backend storage                                                   â•‘
â•‘  â€¢ Priority queues: urgent(9), high(7), ml_tasks(5), batch(3), default(5)   â•‘
â•‘                                                                             â•‘
â•‘  Celery Workers (4 replicas):                                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â•‘
â•‘  â”‚ regenerate_embedding â”‚  â”‚ recompute_quality    â”‚                         â•‘
â•‘  â”‚ Priority: 7          â”‚  â”‚ Priority: 5          â”‚                         â•‘
â•‘  â”‚ Retry: 3x, Delay: 5s â”‚  â”‚ Retry: 2x, Delay:10s â”‚                         â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â•‘
â•‘                                                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â•‘
â•‘  â”‚ update_search_index  â”‚  â”‚ classify_resource    â”‚                         â•‘
â•‘  â”‚ Priority: 9 (urgent) â”‚  â”‚ Priority: 5          â”‚                         â•‘
â•‘  â”‚ Retry: 3x, Delay: 1s â”‚  â”‚ Retry: 2x, Delay:20s â”‚                         â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â•‘
â•‘                                                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â•‘
â•‘  â”‚ invalidate_cache     â”‚  â”‚ update_graph_edges   â”‚                         â•‘
â•‘  â”‚ Priority: 9 (urgent) â”‚  â”‚ Priority: 5          â”‚                         â•‘
â•‘  â”‚ Immediate execution  â”‚  â”‚ Delay: 30s, Batch    â”‚                         â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â•‘
â•‘                                                                             â•‘
â•‘  Celery Beat (Scheduler):                                                   â•‘
â•‘  â€¢ Daily maintenance (2 AM): cleanup, optimization                          â•‘
â•‘  â€¢ Weekly reports (Sunday): analytics, metrics                              â•‘
â•‘  â€¢ Monthly archival (1st): old data archival                                â•‘
â•‘                                                                             â•‘
â•‘  â€¢ Distributed processing                                                   â•‘
â•‘  â€¢ Automatic retries with exponential backoff                               â•‘
â•‘  â€¢ Progress tracking                                                        â•‘
â•‘  â€¢ 400 tasks/minute throughput (4 workers)                                  â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â”‚ Cache Access
                                    â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         LAYER 6: CACHING LAYER                              â•‘
â•‘                            (Redis Cache)                                    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  RedisCache Service:                                                        â•‘
â•‘  â€¢ get(key) â†’ value | None                                                  â•‘
â•‘  â€¢ set(key, value, ttl) â†’ None                                              â•‘
â•‘  â€¢ delete(key) â†’ None                                                       â•‘
â•‘  â€¢ delete_pattern(pattern) â†’ int                                            â•‘
â•‘  â€¢ get_stats() â†’ CacheStats                                                 â•‘
â•‘                                                                             â•‘
â•‘  Cache Key Strategy:                                                        â•‘
â•‘  embedding:{resource_id}        TTL: 3600s (1 hour)                         â•‘
â•‘  quality:{resource_id}          TTL: 1800s (30 min)                         â•‘
â•‘  search_query:{hash}            TTL: 300s (5 min)                           â•‘
â•‘  resource:{resource_id}         TTL: 600s (10 min)                          â•‘
â•‘  graph:{resource_id}:neighbors  TTL: 1800s (30 min)                         â•‘
â•‘  classification:{resource_id}   TTL: 3600s (1 hour)                         â•‘
â•‘                                                                             â•‘
â•‘  Performance:                                                               â•‘
â•‘  â€¢ 60-70% cache hit rate                                                    â•‘
â•‘  â€¢ Sub-millisecond lookups                                                  â•‘
â•‘  â€¢ 50-70% computation reduction                                             â•‘
â•‘  â€¢ Pattern-based invalidation <10ms                                         â•‘
â•‘  â€¢ 2GB memory with allkeys-lru eviction                                     â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â”‚ Data Access
                                    â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                       LAYER 7: DATA ACCESS LAYER                            â•‘
â•‘                         (SQLAlchemy ORM)                                    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  ORM Models:                                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â•‘
â•‘  â”‚   Resource     â”‚  â”‚ TaxonomyNode   â”‚  â”‚  Collection    â”‚                 â•‘
â•‘  â”‚ â€¢ id: UUID     â”‚  â”‚ â€¢ id: UUID     â”‚  â”‚ â€¢ id: UUID     â”‚                 â•‘
â•‘  â”‚ â€¢ title        â”‚  â”‚ â€¢ code         â”‚  â”‚ â€¢ name         â”‚                 â•‘
â•‘  â”‚ â€¢ description  â”‚  â”‚ â€¢ name         â”‚  â”‚ â€¢ owner_id     â”‚                 â•‘
â•‘  â”‚ â€¢ embedding    â”‚  â”‚ â€¢ parent_id    â”‚  â”‚ â€¢ public       â”‚                 â•‘
â•‘  â”‚ â€¢ created_at   â”‚  â”‚ â€¢ level        â”‚  â”‚ â€¢ resources    â”‚                 â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â•‘
â•‘                                                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â•‘
â•‘  â”‚  Annotation    â”‚  â”‚ QualityScore   â”‚  â”‚ MLPrediction   â”‚                 â•‘
â•‘  â”‚ â€¢ id: UUID     â”‚  â”‚ â€¢ id: UUID     â”‚  â”‚ â€¢ id: UUID     â”‚                 â•‘
â•‘  â”‚ â€¢ content      â”‚  â”‚ â€¢ resource_id  â”‚  â”‚ â€¢ resource_id  â”‚                 â•‘
â•‘  â”‚ â€¢ user_id      â”‚  â”‚ â€¢ overall      â”‚  â”‚ â€¢ label        â”‚                 â•‘
â•‘  â”‚ â€¢ resource_id  â”‚  â”‚ â€¢ accuracy     â”‚  â”‚ â€¢ confidence   â”‚                 â•‘
â•‘  â”‚ â€¢ type         â”‚  â”‚ â€¢ completeness â”‚  â”‚ â€¢ model_ver    â”‚                 â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â•‘
â•‘                                                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â•‘
â•‘  â”‚ResourceTaxonomyâ”‚  â”‚UserInteraction â”‚  â”‚   GraphEdge    â”‚                 â•‘
â•‘  â”‚ â€¢ resource_id  â”‚  â”‚ â€¢ user_id      â”‚  â”‚ â€¢ source_id    â”‚                 â•‘
â•‘  â”‚ â€¢ taxonomy_id  â”‚  â”‚ â€¢ resource_id  â”‚  â”‚ â€¢ target_id    â”‚                 â•‘
â•‘  â”‚ â€¢ confidence   â”‚  â”‚ â€¢ type         â”‚  â”‚ â€¢ edge_type    â”‚                 â•‘
â•‘  â”‚ â€¢ method       â”‚  â”‚ â€¢ timestamp    â”‚  â”‚ â€¢ weight       â”‚                 â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â•‘
â•‘                                                                             â•‘
â•‘  â€¢ Declarative models                                                       â•‘
â•‘  â€¢ Relationship management                                                  â•‘
â•‘  â€¢ Connection pooling (20 base + 40 overflow)                               â•‘
â•‘  â€¢ Lazy loading strategies                                                  â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â”‚ SQL Queries
                                    â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         LAYER 8: DATABASE LAYER                             â•‘
â•‘                            (SQLite 3.x)                                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  Core Tables:                                                               â•‘
â•‘  â€¢ resources              - Main resource storage                           â•‘
â•‘  â€¢ taxonomy_nodes         - Hierarchical classification tree                â•‘
â•‘  â€¢ collections            - User-created collections                        â•‘
â•‘  â€¢ annotations            - User annotations and notes                      â•‘
â•‘  â€¢ quality_scores         - 5-dimensional quality assessments               â•‘
â•‘  â€¢ resource_taxonomy      - Many-to-many resource-taxonomy mapping          â•‘
â•‘  â€¢ user_interactions      - User activity tracking                          â•‘
â•‘  â€¢ graph_edges            - Citation and relationship graph                 â•‘
â•‘  â€¢ ml_predictions         - ML classification results                       â•‘
â•‘                                                                             â•‘
â•‘  FTS5 Virtual Tables (Phase 4):                                             â•‘
â•‘  â€¢ resources_fts          - Full-text search index                          â•‘
â•‘    - BM25 ranking algorithm                                                 â•‘
â•‘    - Tokenization and stemming                                              â•‘
â•‘    - Phrase and proximity search                                            â•‘
â•‘                                                                             â•‘
â•‘  Vector Storage (Phase 4, 8):                                               â•‘
â•‘  â€¢ resources.embedding         - Dense vectors (768-dim BERT)               â•‘
â•‘  â€¢ resources.sparse_embedding  - Sparse vectors (SPLADE/TF-IDF)             â•‘
â•‘    - Cosine similarity search                                               â•‘
â•‘    - Efficient vector indexing                                              â•‘
â•‘                                                                             â•‘
â•‘  Optimizations:                                                             â•‘
â•‘  â€¢ WAL mode for concurrent reads/writes                                     â•‘
â•‘  â€¢ Indexes on: id, created_at, updated_at, type, language                   â•‘
â•‘  â€¢ Composite indexes for common queries                                     â•‘
â•‘  â€¢ Connection recycling: 1 hour                                             â•‘
â•‘  â€¢ Pre-ping health checks                                                   â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                    â”‚
                                    â”‚ ML Processing
                                    â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      LAYER 9: MACHINE LEARNING LAYER                        â•‘
â•‘                    (PyTorch + Transformers)                                 â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  Classification Models (Phase 5-7):                                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
â•‘  â”‚ DistilBERT / BERT Transformer                                   â”‚        â•‘
â•‘  â”‚ â€¢ Multi-label classification                                    â”‚        â•‘
â•‘  â”‚ â€¢ Fine-tuned on academic taxonomy                               â”‚        â•‘
â•‘  â”‚ â€¢ Sigmoid activation for multi-label                            â”‚        â•‘
â•‘  â”‚ â€¢ Top-k predictions with confidence scores                      â”‚        â•‘
â•‘  â”‚ â€¢ GPU acceleration (CUDA if available)                          â”‚        â•‘
â•‘  â”‚ â€¢ Lazy loading for memory efficiency                            â”‚        â•‘
â•‘  â”‚ â€¢ Active learning with uncertainty sampling                     â”‚        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
â•‘                                                                             â•‘
â•‘  Embedding Models (Phase 4, 8):                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
â•‘  â”‚ Dense Embeddings (BERT/Sentence-BERT)                           â”‚        â•‘
â•‘  â”‚ â€¢ 768-dimensional vectors                                       â”‚        â•‘
â•‘  â”‚ â€¢ Semantic similarity capture                                   â”‚        â•‘
â•‘  â”‚ â€¢ Batch processing support                                      â”‚        â•‘
â•‘  â”‚ â€¢ Cached for performance                                        â”‚        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
â•‘                                                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
â•‘  â”‚ Sparse Embeddings (SPLADE/TF-IDF)                               â”‚        â•‘
â•‘  â”‚ â€¢ Term importance weighting                                     â”‚        â•‘
â•‘  â”‚ â€¢ Interpretable features                                        â”‚        â•‘
â•‘  â”‚ â€¢ Efficient storage                                             â”‚        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
â•‘                                                                             â•‘
â•‘  Reranking Models (Phase 8):                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
â•‘  â”‚ ColBERT Cross-Encoder                                           â”‚        â•‘
â•‘  â”‚ â€¢ Query-document interaction modeling                           â”‚        â•‘
â•‘  â”‚ â€¢ Fine-grained relevance scoring                                â”‚        â•‘
â•‘  â”‚ â€¢ Applied to top-100 candidates                                 â”‚        â•‘
â•‘  â”‚ â€¢ 1-second timeout for responsiveness                           â”‚        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
â•‘                                                                             â•‘
â•‘  Quality Assessment Models (Phase 9):                                       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
â•‘  â”‚ Isolation Forest (Outlier Detection)                            â”‚        â•‘
â•‘  â”‚ â€¢ 9-dimensional feature space                                   â”‚        â•‘
â•‘  â”‚ â€¢ Anomaly scoring                                               â”‚        â•‘
â•‘  â”‚ â€¢ Contamination rate: 0.1                                       â”‚        â•‘
â•‘  â”‚ â€¢ Flags resources for manual review                             â”‚        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
â•‘                                                                             â•‘
â•‘  Performance:                                                               â•‘
â•‘  â€¢ Classification: 200ms avg (GPU), 800ms (CPU)                             â•‘
â•‘  â€¢ Embedding generation: 200ms avg (GPU), 800ms (CPU)                       â•‘
â•‘  â€¢ Batch processing: 100 docs/min                                           â•‘
â•‘  â€¢ Model memory: ~1.5GB loaded                                              â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```


### Cross-Cutting Concerns

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         CROSS-CUTTING CONCERNS                              â•‘
â•‘                    (Applied Across All Layers)                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  Monitoring & Observability:                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
â•‘  â”‚ â€¢ PredictionMonitor - ML model performance tracking             â”‚        â•‘
â•‘  â”‚ â€¢ Flower Dashboard - Celery task monitoring                     â”‚        â•‘
â•‘  â”‚ â€¢ Event history logging                                         â”‚        â•‘ 
â•‘  â”‚ â€¢ Cache statistics tracking                                     â”‚        â•‘
â•‘  â”‚ â€¢ API endpoints: /api/monitoring/health, /metrics, /cache-stats â”‚        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
â•‘                                                                             â•‘
â•‘  Error Handling & Resilience:                                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
â•‘  â”‚ â€¢ Automatic task retries with exponential backoff               â”‚        â•‘
â•‘  â”‚ â€¢ Circuit breakers for external services                        â”‚        â•‘
â•‘  â”‚ â€¢ Graceful degradation (fallback to cached data)                â”‚        â•‘
â•‘  â”‚ â€¢ Dead letter queues for failed tasks                           â”‚        â•‘
â•‘  â”‚ â€¢ Comprehensive error logging                                   â”‚        â•‘
â•‘  â”‚ â€¢ Health checks for all services                                â”‚        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
â•‘                                                                             â•‘
â•‘  Security & Authentication:                                                 â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
â•‘  â”‚ â€¢ API key authentication                                        â”‚        â•‘
â•‘  â”‚ â€¢ Role-based access control (RBAC)                              â”‚        â•‘
â•‘  â”‚ â€¢ Input validation and sanitization                             â”‚        â•‘
â•‘  â”‚ â€¢ SQL injection prevention (ORM)                                â”‚        â•‘
â•‘  â”‚ â€¢ Rate limiting                                                 â”‚        â•‘
â•‘  â”‚ â€¢ CORS configuration                                            â”‚        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
â•‘                                                                             â•‘
â•‘  Configuration Management:                                                  â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
â•‘  â”‚ â€¢ Environment-based configuration (.env files)                  â”‚        â•‘
â•‘  â”‚ â€¢ Centralized settings (settings.py)                            â”‚        â•‘
â•‘  â”‚ â€¢ Feature flags                                                 â”‚        â•‘
â•‘  â”‚ â€¢ Dynamic configuration updates                                 â”‚        â•‘
â•‘  â”‚ â€¢ Secrets management                                            â”‚        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```


### Design Patterns Applied

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          DESIGN PATTERNS SUMMARY                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  1. LAYERED ARCHITECTURE                                                    â•‘
â•‘     â€¢ Clear separation of concerns across 9 layers                          â•‘
â•‘     â€¢ Dependencies flow downward                                            â•‘
â•‘     â€¢ Each layer has single responsibility                                  â•‘
â•‘                                                                             â•‘
â•‘  2. DOMAIN-DRIVEN DESIGN (Phase 11)                                         â•‘
â•‘     â€¢ Rich domain models with business logic                                â•‘
â•‘     â€¢ Ubiquitous language across codebase                                   â•‘
â•‘     â€¢ Bounded contexts for different domains                                â•‘
â•‘     â€¢ Separation from persistence layer                                     â•‘
â•‘                                                                             â•‘
â•‘  3. EVENT-DRIVEN ARCHITECTURE (Phase 12.5)                                  â•‘
â•‘     â€¢ Loose coupling between components                                     â•‘
â•‘     â€¢ Asynchronous processing                                               â•‘
â•‘     â€¢ Pub/sub pattern for notifications                                     â•‘
â•‘     â€¢ Automatic consistency maintenance                                     â•‘
â•‘                                                                             â•‘
â•‘  4. REPOSITORY PATTERN                                                      â•‘
â•‘     â€¢ Abstract data access layer                                            â•‘
â•‘     â€¢ Services interact with repositories, not DB directly                  â•‘
â•‘     â€¢ Testable with mock repositories                                       â•‘
â•‘                                                                             â•‘
â•‘  5. STRATEGY PATTERN                                                        â•‘
â•‘     â€¢ Pluggable algorithms (recommendations, search)                        â•‘
â•‘     â€¢ Runtime strategy selection                                            â•‘
â•‘     â€¢ Easy to add new strategies                                            â•‘
â•‘                                                                             â•‘
â•‘  6. SINGLETON PATTERN                                                       â•‘
â•‘     â€¢ EventEmitter, Cache - single instance across application              â•‘
â•‘     â€¢ Global access point                                                   â•‘
â•‘                                                                             â•‘
â•‘  7. OBSERVER PATTERN                                                        â•‘
â•‘     â€¢ Event listeners register for notifications                            â•‘
â•‘     â€¢ Decoupled event producers and consumers                               â•‘
â•‘     â€¢ Multiple handlers per event                                           â•‘
â•‘                                                                             â•‘
â•‘  8. LAZY LOADING                                                            â•‘
â•‘     â€¢ ML models loaded on-demand                                            â•‘
â•‘     â€¢ Faster application startup                                            â•‘
â•‘     â€¢ Memory efficiency                                                     â•‘
â•‘                                                                             â•‘
â•‘  9. CACHING PATTERN                                                         â•‘
â•‘     â€¢ Cache-aside pattern                                                   â•‘
â•‘     â€¢ TTL-based expiration                                                  â•‘
â•‘     â€¢ Pattern-based invalidation                                            â•‘
â•‘                                                                             â•‘
â•‘  10. TASK QUEUE PATTERN                                                     â•‘
â•‘      â€¢ Asynchronous task execution                                          â•‘
â•‘      â€¢ Priority-based scheduling                                            â•‘
â•‘      â€¢ Retry logic with backoff                                             â•‘
â•‘      â€¢ Distributed processing                                               â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```


### Request Lifecycle Example

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              EXAMPLE: Resource Update Request Flow                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  1. CLIENT REQUEST                                                          â•‘
â•‘     PUT /api/resources/abc-123                                              â•‘
â•‘     Body: { "title": "Updated Title", "description": "New content..." }     â•‘
â•‘                                                                             â•‘
â•‘  2. PRESENTATION LAYER (FastAPI Router)                                     â•‘
â•‘     â€¢ Validate request schema                                               â•‘
â•‘     â€¢ Authenticate user                                                     â•‘
â•‘     â€¢ Call ResourceService.update(id, data)                                 â•‘
â•‘                                                                             â•‘
â•‘  3. SERVICE LAYER (ResourceService)                                         â•‘
â•‘     â€¢ Fetch existing resource from database                                 â•‘
â•‘     â€¢ Convert to ResourceDomain object                                      â•‘
â•‘     â€¢ Apply updates and validate business rules                             â•‘
â•‘     â€¢ Detect changes: content_changed = True                                â•‘
â•‘     â€¢ Persist to database via ORM                                           â•‘
â•‘     â€¢ Emit events: resource.updated, resource.content_changed               â•‘
â•‘                                                                             â•‘
â•‘  4. EVENT LAYER (EventEmitter)                                              â•‘
â•‘     â€¢ Dispatch resource.updated event                                       â•‘
â•‘       â”œâ”€â–º Hook: update_search_index_task (priority=9, countdown=1s)         â•‘
â•‘       â””â”€â–º Hook: invalidate_cache_task (priority=9, immediate)               â•‘
â•‘     â€¢ Dispatch resource.content_changed event                               â•‘
â•‘       â””â”€â–º Hook: regenerate_embedding_task (priority=7, countdown=5s)        â•‘
â•‘                                                                             â•‘
â•‘  5. TASK LAYER (Celery Workers - Parallel Execution)                        â•‘
â•‘     Worker 1 (t=0s):  invalidate_cache_task                                 â•‘
â•‘       â€¢ Delete cache keys: resource:abc-123:*                               â•‘
â•‘       â€¢ Duration: ~5ms                                                      â•‘
â•‘                                                                             â•‘
â•‘     Worker 2 (t=1s):  update_search_index_task                              â•‘
â•‘       â€¢ Update FTS5 index with new content                                  â•‘
â•‘       â€¢ Duration: ~50ms                                                     â•‘
â•‘                                                                             â•‘
â•‘     Worker 3 (t=5s):  regenerate_embedding_task                             â•‘
â•‘       â€¢ Generate new BERT embedding (768-dim)                               â•‘
â•‘       â€¢ Store in database and cache                                         â•‘
â•‘       â€¢ Duration: ~200ms (GPU)                                              â•‘
â•‘                                                                             â•‘
â•‘  6. RESPONSE TO CLIENT                                                      â•‘
â•‘     Status: 200 OK                                                          â•‘
â•‘     Body: { "id": "abc-123", "title": "Updated Title", ... }                â•‘
â•‘     Response Time: ~50ms (synchronous part only)                            â•‘
â•‘                                                                             â•‘
â•‘  7. EVENTUAL CONSISTENCY                                                    â•‘
â•‘     â€¢ t=0s:  Cache invalidated â†’ Fresh data on next request                 â•‘
â•‘     â€¢ t=1s:  Search index updated â†’ Resource searchable                     â•‘
â•‘     â€¢ t=5s:  Embedding regenerated â†’ Semantic search updated                â•‘
â•‘     â€¢ Total async processing time: ~5 seconds                               â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```


### Performance Characteristics

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      SYSTEM PERFORMANCE METRICS                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  API Response Times:                                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
â•‘  â”‚ Endpoint                   Avg      P95      P99    Cache Impactâ”‚        â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â•‘
â•‘  â”‚ GET /resources/{id}         15ms     30ms     50ms   -80%       â”‚        â•‘
â•‘  â”‚ POST /resources             50ms    100ms    150ms   N/A        â”‚        â•‘
â•‘  â”‚ PUT /resources/{id}         45ms     90ms    130ms   N/A        â”‚        â•‘
â•‘  â”‚ POST /search/hybrid        150ms    300ms    500ms   -60%       â”‚        â•‘
â•‘  â”‚ POST /search/three-way     250ms    500ms    800ms   -50%       â”‚        â•‘
â•‘  â”‚ POST /classification       200ms    400ms    600ms   -70%       â”‚        â•‘
â•‘  â”‚ POST /quality/compute      100ms    200ms    300ms   -65%       â”‚        â•‘
â•‘  â”‚ GET /recommendations       120ms    250ms    400ms   -55%       â”‚        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
â•‘                                                                             â•‘
â•‘  Throughput Capacity:                                                       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
â•‘  â”‚ Component              Throughput      Scaling Strategy         â”‚        â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â•‘
â•‘  â”‚ FastAPI Application    1000 req/s     Horizontal (load balance) â”‚        â•‘
â•‘  â”‚ Database (SQLite)      500 writes/s   Migrate to PostgreSQL     â”‚        â•‘
â•‘  â”‚ Redis Cache            100k ops/s     Redis Cluster             â”‚        â•‘
â•‘  â”‚ Celery Workers (4x)    400 tasks/min  Add more workers          â”‚        â•‘
â•‘  â”‚ ML Classification      50 infer/s     Batch processing          â”‚        â•‘
â•‘  â”‚ Embedding Generation   100 docs/min   Batch + GPU acceleration  â”‚        â•‘
â•‘  â”‚ Search (FTS5)          500 queries/s  Sharding                  â”‚        â•‘
â•‘  â”‚ Vector Search          200 queries/s  Approximate NN (FAISS)    â”‚        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
â•‘                                                                             â•‘
â•‘  Cache Performance:                                                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
â•‘  â”‚ Cache Type          Hit Rate    Latency (hit)   Latency (miss)  â”‚        â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â•‘
â•‘  â”‚ Embeddings          70%         0.5ms           200ms           â”‚        â•‘
â•‘  â”‚ Quality Scores      65%         0.3ms           100ms           â”‚        â•‘
â•‘  â”‚ Search Results      60%         0.8ms           150ms           â”‚        â•‘
â•‘  â”‚ Resource Data       75%         0.4ms           15ms            â”‚        â•‘
â•‘  â”‚ Graph Neighbors     68%         0.6ms           50ms            â”‚        â•‘
â•‘  â”‚ ML Predictions      72%         0.5ms           200ms           â”‚        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
â•‘                                                                             â•‘
â•‘  Overall Cache Impact: 50-70% reduction in computation time                 â•‘
â•‘                                                                             â•‘
â•‘  Task Processing:                                                           â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
â•‘  â”‚ Task Type                Duration    Success Rate   Retry Rate  â”‚        â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â•‘
â•‘  â”‚ regenerate_embedding     200ms      99.5%          0.3%         â”‚        â•‘
â•‘  â”‚ recompute_quality        100ms      99.8%          0.1%         â”‚        â•‘
â•‘  â”‚ update_search_index      50ms       99.9%          0.05%        â”‚        â•‘
â•‘  â”‚ classify_resource        250ms      99.2%          0.5%         â”‚        â•‘
â•‘  â”‚ invalidate_cache         5ms        100%           0%           â”‚        â•‘
â•‘  â”‚ update_graph_edges       80ms       99.5%          0.3%         â”‚        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
â•‘                                                                             â•‘
â•‘  Overall Task Reliability: >99% success rate with automatic retries         â•‘
â•‘                                                                             â•‘
â•‘  Scalability Limits:                                                        â•‘
â•‘  â€¢ Current: ~1M documents, ~100 concurrent users                            â•‘
â•‘  â€¢ Recommended for 1M+ resources: Migrate to PostgreSQL + pgvector          â•‘
â•‘  â€¢ Recommended for 500+ users: Add load balancer + multiple instances       â•‘
â•‘  â€¢ Recommended for 100M+ vectors: Use FAISS or Milvus for approximate NN    â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```


### Technology Stack

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          COMPLETE TECHNOLOGY STACK                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘  Web Framework:        FastAPI 0.104+                                       â•‘
â•‘                        â€¢ Async/await support                                â•‘
â•‘                        â€¢ Automatic OpenAPI docs                             â•‘
â•‘                        â€¢ Pydantic validation                                â•‘
â•‘                        â€¢ High performance (Starlette + Uvicorn)             â•‘
â•‘                                                                             â•‘
â•‘  Database:             SQLite 3.x (Development/Small Scale)                 â•‘
â•‘                        â€¢ FTS5 full-text search                              â•‘
â•‘                        â€¢ JSON support                                       â•‘
â•‘                        â€¢ WAL mode for concurrency                           â•‘
â•‘                        â€¢ Migration path to PostgreSQL                       â•‘
â•‘                                                                             â•‘
â•‘  ORM:                  SQLAlchemy 2.0+                                      â•‘
â•‘                        â€¢ Declarative models                                 â•‘
â•‘                        â€¢ Relationship management                            â•‘
â•‘                        â€¢ Connection pooling                                 â•‘
â•‘                        â€¢ Migration support (Alembic)                        â•‘
â•‘                                                                             â•‘
â•‘  Cache:                Redis 7.x                                            â•‘
â•‘                        â€¢ In-memory data store                               â•‘
â•‘                        â€¢ Pub/sub messaging                                  â•‘
â•‘                        â€¢ TTL-based expiration                               â•‘
â•‘                        â€¢ Pattern-based operations                           â•‘
â•‘                                                                             â•‘
â•‘  Task Queue:           Celery 5.x                                           â•‘
â•‘                        â€¢ Distributed task processing                        â•‘
â•‘                        â€¢ Priority queues                                    â•‘
â•‘                        â€¢ Retry mechanisms                                   â•‘
â•‘                        â€¢ Scheduled tasks (Celery Beat)                      â•‘
â•‘                        â€¢ Monitoring (Flower)                                â•‘
â•‘                                                                             â•‘
â•‘  ML Framework:         PyTorch 2.x                                          â•‘
â•‘                        â€¢ Neural network training                            â•‘
â•‘                        â€¢ GPU acceleration (CUDA)                            â•‘
â•‘                        â€¢ Model serialization                                â•‘
â•‘                        â€¢ Automatic differentiation                          â•‘
â•‘                                                                             â•‘
â•‘  Transformers:         Hugging Face Transformers 4.x                        â•‘
â•‘                        â€¢ Pre-trained models (BERT, DistilBERT)              â•‘
â•‘                        â€¢ Tokenizers                                         â•‘
â•‘                        â€¢ Fine-tuning utilities                              â•‘
â•‘                        â€¢ Model hub integration                              â•‘
â•‘                                                                             â•‘
â•‘  ML Models:            â€¢ DistilBERT (Classification)                        â•‘
â•‘                        â€¢ BERT/Sentence-BERT (Embeddings)                    â•‘
â•‘                        â€¢ SPLADE (Sparse vectors)                            â•‘
â•‘                        â€¢ ColBERT (Reranking)                                â•‘
â•‘                        â€¢ Isolation Forest (Outlier detection)               â•‘
â•‘                                                                             â•‘
â•‘  Search:               â€¢ SQLite FTS5 (Keyword search)                       â•‘
â•‘                        â€¢ Custom vector similarity (Dense)                   â•‘
â•‘                        â€¢ TF-IDF/SPLADE (Sparse)                             â•‘
â•‘                        â€¢ Reciprocal Rank Fusion (RRF)                       â•‘
â•‘                                                                             â•‘
â•‘  Data Science:         â€¢ NumPy (Numerical computing)                        â•‘
â•‘                        â€¢ Pandas (Data manipulation)                         â•‘
â•‘                        â€¢ Scikit-learn (ML utilities, Isolation Forest)      â•‘
â•‘                                                                             â•‘
â•‘  Testing:              â€¢ Pytest (Test framework)                            â•‘
â•‘                        â€¢ pytest-asyncio (Async tests)                       â•‘
â•‘                        â€¢ pytest-xdist (Parallel execution)                  â•‘
â•‘                        â€¢ pytest-cov (Coverage)                              â•‘
â•‘                                                                             â•‘
â•‘  Containerization:     Docker & Docker Compose                              â•‘
â•‘                        â€¢ Multi-service orchestration                        â•‘
â•‘                        â€¢ Service isolation                                  â•‘
â•‘                        â€¢ Volume management                                  â•‘
â•‘                        â€¢ Health checks                                      â•‘
â•‘                                                                             â•‘
â•‘  Python Version:       Python 3.11+                                         â•‘
â•‘                        â€¢ Type hints support                                 â•‘
â•‘                        â€¢ Performance improvements                           â•‘
â•‘                        â€¢ Enhanced error messages                            â•‘
â•‘                                                                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```


---

## Phase 13.5: Vertical Slice Architecture

### Modular Architecture Overview

Phase 13.5 introduces a vertical slice architecture, transitioning from a layered monolith to independent, self-contained modules. Each module encapsulates all layers (router, service, schema, model, handlers) for a specific domain.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PHASE 13.5: VERTICAL SLICE ARCHITECTURE                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        SHARED KERNEL                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”‚
â”‚  â”‚  â”‚  Database   â”‚  â”‚  Event Bus  â”‚  â”‚ Base Models â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  (engine,   â”‚  â”‚  (pub/sub)  â”‚  â”‚  (mixins)   â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  session)   â”‚  â”‚             â”‚  â”‚             â”‚               â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                    â”‚                    â”‚                   â”‚
â”‚           â”‚                    â”‚                    â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        MODULE LAYER                               â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”‚
â”‚  â”‚  â”‚ Collections  â”‚  â”‚  Resources   â”‚  â”‚    Search    â”‚            â”‚  â”‚
â”‚  â”‚  â”‚   Module     â”‚  â”‚   Module     â”‚  â”‚   Module     â”‚            â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ router.py  â”‚  â”‚ â€¢ router.py  â”‚  â”‚ â€¢ router.py  â”‚            â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ service.py â”‚  â”‚ â€¢ service.py â”‚  â”‚ â€¢ service.py â”‚            â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ schema.py  â”‚  â”‚ â€¢ schema.py  â”‚  â”‚ â€¢ schema.py  â”‚            â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ model.py   â”‚  â”‚ â€¢ model.py   â”‚  â”‚ â€¢ model.py   â”‚            â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ handlers.pyâ”‚  â”‚ â€¢ handlers.pyâ”‚  â”‚ â€¢ handlers.pyâ”‚            â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ __init__.pyâ”‚  â”‚ â€¢ __init__.pyâ”‚  â”‚ â€¢ __init__.pyâ”‚            â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚
â”‚  â”‚         â”‚                  â”‚                  â”‚                   â”‚  â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚  â”‚
â”‚  â”‚                            â”‚                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                         â”‚
â”‚                               â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    APPLICATION ENTRY POINT                      â”‚    â”‚
â”‚  â”‚                         (main.py)                               â”‚    â”‚
â”‚  â”‚                                                                 â”‚    â”‚
â”‚  â”‚  â€¢ Register all modules dynamically                             â”‚    â”‚
â”‚  â”‚  â€¢ Register event handlers on startup                           â”‚    â”‚
â”‚  â”‚  â€¢ Maintain backward compatibility                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Event-Driven Communication

Modules communicate through events rather than direct service calls, eliminating circular dependencies and enabling loose coupling.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EVENT-DRIVEN MODULE COMMUNICATION                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Resources Module                              â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  delete_resource(resource_id)                                    â”‚   â”‚
â”‚  â”‚       â”‚                                                          â”‚   â”‚
â”‚  â”‚       â”œâ”€ Delete from database                                    â”‚   â”‚
â”‚  â”‚       â”‚                                                          â”‚   â”‚
â”‚  â”‚       â””â”€ Emit event: "resource.deleted"                          â”‚   â”‚
â”‚  â”‚            payload: { resource_id: "abc-123" }                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚                                           â”‚
â”‚                             â”‚ Event Bus                                 â”‚
â”‚                             â”‚ (in-memory pub/sub)                       â”‚
â”‚                             â”‚                                           â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚       â”‚                     â”‚                     â”‚                     â”‚
â”‚       â–¼                     â–¼                     â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚Handler 1â”‚          â”‚Handler 2â”‚          â”‚Handler 3â”‚                 â”‚
â”‚  â”‚(Colls)  â”‚          â”‚(Search) â”‚          â”‚(Other)  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â”‚
â”‚       â”‚                    â”‚                    â”‚                       â”‚
â”‚       â–¼                    â–¼                    â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Collections Module                            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  handle_resource_deleted(payload)                                â”‚   â”‚
â”‚  â”‚       â”‚                                                          â”‚   â”‚
â”‚  â”‚       â”œâ”€ Find collections with resource                          â”‚   â”‚
â”‚  â”‚       â”‚                                                          â”‚   â”‚
â”‚  â”‚       â”œâ”€ Remove resource from collections                        â”‚   â”‚
â”‚  â”‚       â”‚                                                          â”‚   â”‚
â”‚  â”‚       â””â”€ Recompute collection embeddings                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Benefits:                                                              â”‚
â”‚  â€¢ No direct imports between modules                                    â”‚
â”‚  â€¢ No circular dependencies                                             â”‚
â”‚  â€¢ Easy to add new event handlers                                       â”‚
â”‚  â€¢ Error isolation (one handler failure doesn't affect others)          â”‚
â”‚  â€¢ Comprehensive event metrics and monitoring                           â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Module Structure

Each module follows a consistent structure with clear boundaries and public interfaces:

```
app/modules/{module_name}/
â”œâ”€â”€ __init__.py          # Public interface (exports router, service, schemas)
â”œâ”€â”€ router.py            # FastAPI endpoints
â”œâ”€â”€ service.py           # Business logic
â”œâ”€â”€ schema.py            # Pydantic models
â”œâ”€â”€ model.py             # SQLAlchemy models (optional, during migration)
â”œâ”€â”€ handlers.py          # Event handlers
â”œâ”€â”€ README.md            # Module documentation
â””â”€â”€ tests/               # Module-specific tests
    â”œâ”€â”€ test_service.py
    â”œâ”€â”€ test_router.py
    â””â”€â”€ test_handlers.py
```

### Module Dependencies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MODULE DEPENDENCY GRAPH                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                      â”‚  Shared Kernel  â”‚                                â”‚
â”‚                      â”‚  â€¢ database     â”‚                                â”‚
â”‚                      â”‚  â€¢ event_bus    â”‚                                â”‚
â”‚                      â”‚  â€¢ base_model   â”‚                                â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                               â”‚                                         â”‚
â”‚                               â”‚ (allowed dependency)                    â”‚
â”‚                               â”‚                                         â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚       â”‚                       â”‚                       â”‚                 â”‚
â”‚       â–¼                       â–¼                       â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚Collectionsâ”‚          â”‚Resourcesâ”‚            â”‚ Search  â”‚             â”‚
â”‚  â”‚  Module  â”‚          â”‚ Module  â”‚            â”‚ Module  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚       â”‚                       â”‚                       â”‚                 â”‚
â”‚       â”‚                       â”‚                       â”‚                 â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                               â”‚                                         â”‚
â”‚                               â”‚ (NO direct imports)                     â”‚
â”‚                               â”‚ (communicate via events)                â”‚
â”‚                               â”‚                                         â”‚
â”‚                               â–¼                                         â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                      â”‚    Event Bus    â”‚                                â”‚
â”‚                      â”‚  (pub/sub only) â”‚                                â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                         â”‚
â”‚  Dependency Rules:                                                      â”‚
â”‚  âœ“ Modules MAY depend on Shared Kernel                                  â”‚
â”‚  âœ“ Modules MAY emit events to Event Bus                                 â”‚
â”‚  âœ“ Modules MAY subscribe to events from Event Bus                       â”‚
â”‚  âœ— Modules MUST NOT import from other modules                           â”‚
â”‚  âœ— Modules MUST NOT call other module services directly                 â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Event Bus Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          EVENT BUS INTERNALS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        EventBus Class                            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Attributes:                                                     â”‚   â”‚
â”‚  â”‚    â€¢ _handlers: Dict[str, List[Callable]]                        â”‚   â”‚
â”‚  â”‚    â€¢ _metrics: EventMetrics                                      â”‚   â”‚
â”‚  â”‚    â€¢ _logger: Logger                                             â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Methods:                                                        â”‚   â”‚
â”‚  â”‚    â€¢ subscribe(event_type, handler, priority)                    â”‚   â”‚
â”‚  â”‚    â€¢ emit(event_type, payload, priority)                         â”‚   â”‚
â”‚  â”‚    â€¢ get_metrics() â†’ EventMetrics                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Event Flow:                                                            â”‚
â”‚                                                                         â”‚
â”‚  1. Module emits event                                                  â”‚
â”‚     event_bus.emit("resource.deleted", {"resource_id": "123"})          â”‚
â”‚                                                                         â”‚
â”‚  2. Event Bus looks up handlers                                         â”‚
â”‚     handlers = _handlers.get("resource.deleted", [])                    â”‚
â”‚                                                                         â”‚
â”‚  3. Execute handlers in priority order                                  â”‚
â”‚     for handler in sorted(handlers, key=priority):                      â”‚
â”‚         try:                                                            â”‚
â”‚             handler(payload)                                            â”‚
â”‚         except Exception as e:                                          â”‚
â”‚             log_error(e)  # Error isolation                             â”‚
â”‚             continue      # Don't stop other handlers                   â”‚
â”‚                                                                         â”‚
â”‚  4. Track metrics                                                       â”‚
â”‚     â€¢ events_emitted++                                                  â”‚
â”‚     â€¢ events_delivered += len(handlers)                                 â”‚
â”‚     â€¢ handler_errors++ (if any failures)                                â”‚
â”‚     â€¢ latency_ms (p50, p95, p99)                                        â”‚
â”‚                                                                         â”‚
â”‚  Monitoring Endpoint: GET /monitoring/events                            â”‚
â”‚  {                                                                      â”‚
â”‚    "events_emitted": 1523,                                              â”‚
â”‚    "events_delivered": 4569,                                            â”‚
â”‚    "handler_errors": 3,                                                 â”‚
â”‚    "event_types": {                                                     â”‚
â”‚      "resource.deleted": 234,                                           â”‚
â”‚      "resource.updated": 1289                                           â”‚
â”‚    },                                                                   â”‚
â”‚    "latency_ms": {                                                      â”‚
â”‚      "p50": 0.8,                                                        â”‚
â”‚      "p95": 2.3,                                                        â”‚
â”‚      "p99": 5.1                                                         â”‚
â”‚    }                                                                    â”‚
â”‚  }                                                                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Migration Strategy

The transition from layered to modular architecture follows a phased approach:

```
Phase 1: Shared Kernel Setup
  âœ“ Extract database, event_bus, base_model to app/shared/
  âœ“ Update all imports to use shared kernel

Phase 2: Extract First Module (Collections)
  âœ“ Create app/modules/collections/ structure
  âœ“ Move router, service, schema to module
  âœ“ Create event handlers for cross-module communication
  âœ“ Keep models in database/models.py temporarily

Phase 3: Extract Second Module (Resources)
  âœ“ Create app/modules/resources/ structure
  âœ“ Move router, service, schema to module
  âœ“ Replace direct service calls with event emissions
  âœ“ Verify event-driven flow works

Phase 4: Extract Third Module (Search)
  âœ“ Create app/modules/search/ structure
  âœ“ Consolidate multiple search services into unified module
  âœ“ Move router, schema to module
  âœ“ Maintain backward compatibility

Phase 5: Update Application Entry Point
  âœ“ Implement dynamic module registration
  âœ“ Register event handlers on startup
  âœ“ Maintain API backward compatibility

Phase 6: Cleanup and Documentation
  âœ“ Remove deprecated layered structure files
  âœ“ Update architecture documentation
  âœ“ Create migration guide
  âœ“ Add module-specific documentation

Future Phases:
  â€¢ Extract remaining modules (Authority, Classification, etc.)
  â€¢ Move models from database/models.py to module model.py
  â€¢ Complete transition to vertical slices
```

### Benefits of Vertical Slice Architecture

1. **Independent Development**: Teams can work on modules independently
2. **Clear Boundaries**: Each module has well-defined responsibilities
3. **Easier Testing**: Modules can be tested in isolation
4. **Reduced Coupling**: Event-driven communication eliminates direct dependencies
5. **Better Scalability**: Modules can be extracted into microservices if needed
6. **Improved Maintainability**: Changes are localized to specific modules
7. **Flexible Deployment**: Modules can be deployed independently (future)

---

## Phase 13.5: Vertical Slice Refactoring

### Modular Architecture Implementation

Phase 13.5 introduces a vertical slice architecture, transitioning from a traditional layered architecture to self-contained modules that encapsulate all layers of functionality.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PHASE 13.5: VERTICAL SLICE ARCHITECTURE                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Traditional Layered Architecture (Before):                             â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Routers Layer:  resources.py | collections.py | search.py      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Services Layer: resource_service.py | collection_service.py     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Schemas Layer:  resource.py | collection.py | search.py        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Models Layer:   models.py (all models in one file)             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Problems:                                                              â”‚
â”‚  â€¢ Tight coupling between layers                                        â”‚
â”‚  â€¢ Circular dependencies (Resources â†” Collections)                      â”‚
â”‚  â€¢ Changes ripple across multiple files                                 â”‚
â”‚  â€¢ Difficult to extract features into microservices                     â”‚
â”‚                                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                         â”‚
â”‚  Vertical Slice Architecture (After):                                   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Resources Module â”‚  â”‚Collections Moduleâ”‚  â”‚  Search Module   â”‚     â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚ â”‚  router.py   â”‚ â”‚  â”‚ â”‚  router.py   â”‚ â”‚  â”‚ â”‚  router.py   â”‚ â”‚     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚ â”‚  service.py  â”‚ â”‚  â”‚ â”‚  service.py  â”‚ â”‚  â”‚ â”‚  service.py  â”‚ â”‚     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚ â”‚  schema.py   â”‚ â”‚  â”‚ â”‚  schema.py   â”‚ â”‚  â”‚ â”‚  schema.py   â”‚ â”‚     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚ â”‚  model.py    â”‚ â”‚  â”‚ â”‚  model.py    â”‚ â”‚  â”‚ â”‚ handlers.py  â”‚ â”‚     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                  â”‚     â”‚
â”‚  â”‚ â”‚ handlers.py  â”‚ â”‚  â”‚ â”‚ handlers.py  â”‚ â”‚  â”‚                  â”‚     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                     â”‚                     â”‚                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                 â”‚                                       â”‚
â”‚                                 â–¼                                       â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚    Shared Kernel        â”‚                          â”‚
â”‚                    â”‚  â€¢ database.py          â”‚                          â”‚
â”‚                    â”‚  â€¢ event_bus.py         â”‚                          â”‚
â”‚                    â”‚  â€¢ base_model.py        â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                         â”‚
â”‚  Benefits:                                                              â”‚
â”‚  â€¢ High cohesion - related code stays together                          â”‚
â”‚  â€¢ Low coupling - modules communicate via events                        â”‚
â”‚  â€¢ No circular dependencies                                             â”‚
â”‚  â€¢ Easy to extract into microservices                                   â”‚
â”‚  â€¢ Clear module boundaries                                              â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Resources Module Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RESOURCES MODULE DETAIL                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  app/modules/resources/                                                 â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ __init__.py                                                        â”‚
â”‚  â”‚   Exports:                                                          â”‚
â”‚  â”‚   â€¢ resources_router                                                â”‚
â”‚  â”‚   â€¢ create_pending_resource, get_resource, list_resources           â”‚
â”‚  â”‚   â€¢ update_resource, delete_resource, process_ingestion             â”‚
â”‚  â”‚   â€¢ ResourceCreate, ResourceUpdate, ResourceRead, ResourceStatus    â”‚
â”‚  â”‚   â€¢ Resource (model)                                                â”‚
â”‚  â”‚   Metadata: __version__ = "1.0.0", __domain__ = "resources"         â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ router.py                                                          â”‚
â”‚  â”‚   Endpoints:                                                        â”‚
â”‚  â”‚   â€¢ POST   /resources              - URL ingestion                  â”‚
â”‚  â”‚   â€¢ GET    /resources              - List with filtering            â”‚
â”‚  â”‚   â€¢ GET    /resources/{id}         - Get single resource            â”‚
â”‚  â”‚   â€¢ PUT    /resources/{id}         - Update resource                â”‚
â”‚  â”‚   â€¢ DELETE /resources/{id}         - Delete resource                â”‚
â”‚  â”‚   â€¢ GET    /resources/{id}/status  - Ingestion status               â”‚
â”‚  â”‚   â€¢ PUT    /resources/{id}/classify - Override classification       â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ service.py                                                         â”‚
â”‚  â”‚   Functions:                                                        â”‚
â”‚  â”‚   â€¢ create_pending_resource(db, payload) â†’ Resource                 â”‚
â”‚  â”‚   â€¢ process_ingestion(resource_id, ...) â†’ None                      â”‚
â”‚  â”‚   â€¢ get_resource(db, resource_id) â†’ Resource                        â”‚
â”‚  â”‚   â€¢ list_resources(db, filters, page, sort) â†’ (List, int)           â”‚
â”‚  â”‚   â€¢ update_resource(db, resource_id, payload) â†’ Resource            â”‚
â”‚  â”‚   â€¢ delete_resource(db, resource_id) â†’ None                         â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”‚   Events Emitted:                                                   â”‚
â”‚  â”‚   â€¢ resource.created                                                â”‚
â”‚  â”‚   â€¢ resource.updated                                                â”‚
â”‚  â”‚   â€¢ resource.deleted                                                â”‚
â”‚  â”‚   â€¢ resource.content_changed                                        â”‚
â”‚  â”‚   â€¢ resource.metadata_changed                                       â”‚
â”‚  â”‚   â€¢ ingestion.started                                               â”‚
â”‚  â”‚   â€¢ ingestion.completed                                             â”‚
â”‚  â”‚   â€¢ ingestion.failed                                                â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ schema.py                                                          â”‚
â”‚  â”‚   Schemas:                                                          â”‚
â”‚  â”‚   â€¢ ResourceBase - Common fields                                    â”‚
â”‚  â”‚   â€¢ ResourceCreate - Creation schema                                â”‚
â”‚  â”‚   â€¢ ResourceUpdate - Update schema (all optional)                   â”‚
â”‚  â”‚   â€¢ ResourceRead - Response schema                                  â”‚
â”‚  â”‚   â€¢ ResourceStatus - Ingestion status                               â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ model.py                                                           â”‚
â”‚  â”‚   Models:                                                           â”‚
â”‚  â”‚   â€¢ Resource - Complete SQLAlchemy model                            â”‚
â”‚  â”‚     - Dublin Core metadata fields                                   â”‚
â”‚  â”‚     - Scholarly metadata (DOI, PMID, etc.)                          â”‚
â”‚  â”‚     - Quality fields                                                â”‚
â”‚  â”‚     - Embeddings (dense & sparse)                                   â”‚
â”‚  â”‚     - Relationships (string-based to avoid circular imports)        â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ handlers.py                                                        â”‚
â”‚  â”‚   Event Handlers:                                                   â”‚
â”‚  â”‚   â€¢ handle_collection_updated(payload) - Placeholder               â”‚
â”‚  â”‚   â€¢ register_handlers() - Subscribe to events                       â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ README.md                                                          â”‚
â”‚  â”‚   Documentation:                                                    â”‚
â”‚  â”‚   â€¢ Module overview                                                 â”‚
â”‚  â”‚   â€¢ Public interface                                                â”‚
â”‚  â”‚   â€¢ Events emitted/subscribed                                       â”‚
â”‚  â”‚   â€¢ Dependencies                                                    â”‚
â”‚  â”‚   â€¢ Usage examples                                                  â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â””â”€â”€ tests/                                                             â”‚
â”‚      â””â”€â”€ __init__.py                                                   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Collections Module Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       COLLECTIONS MODULE DETAIL                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  app/modules/collections/                                               â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ __init__.py                                                        â”‚
â”‚  â”‚   Exports:                                                          â”‚
â”‚  â”‚   â€¢ collections_router                                              â”‚
â”‚  â”‚   â€¢ CollectionService                                               â”‚
â”‚  â”‚   â€¢ CollectionCreate, CollectionUpdate, CollectionRead              â”‚
â”‚  â”‚   â€¢ Collection, CollectionResource (models)                         â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ router.py                                                          â”‚
â”‚  â”‚   Endpoints:                                                        â”‚
â”‚  â”‚   â€¢ POST   /collections                - Create collection          â”‚
â”‚  â”‚   â€¢ GET    /collections                - List collections           â”‚
â”‚  â”‚   â€¢ GET    /collections/{id}           - Get collection             â”‚
â”‚  â”‚   â€¢ PUT    /collections/{id}           - Update collection          â”‚
â”‚  â”‚   â€¢ DELETE /collections/{id}           - Delete collection          â”‚
â”‚  â”‚   â€¢ PUT    /collections/{id}/resources - Update resources           â”‚
â”‚  â”‚   â€¢ GET    /collections/{id}/recommendations - Get recommendations  â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ service.py                                                         â”‚
â”‚  â”‚   Class: CollectionService                                          â”‚
â”‚  â”‚   Methods:                                                          â”‚
â”‚  â”‚   â€¢ create_collection(data) â†’ Collection                            â”‚
â”‚  â”‚   â€¢ get_collection(collection_id) â†’ Collection                      â”‚
â”‚  â”‚   â€¢ list_collections(filters) â†’ List[Collection]                    â”‚
â”‚  â”‚   â€¢ update_collection(collection_id, data) â†’ Collection             â”‚
â”‚  â”‚   â€¢ delete_collection(collection_id) â†’ None                         â”‚
â”‚  â”‚   â€¢ update_resources(collection_id, resource_ids) â†’ Collection      â”‚
â”‚  â”‚   â€¢ get_recommendations(collection_id) â†’ List[Recommendation]       â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”‚   Events Emitted:                                                   â”‚
â”‚  â”‚   â€¢ collection.created                                              â”‚
â”‚  â”‚   â€¢ collection.updated                                              â”‚
â”‚  â”‚   â€¢ collection.deleted                                              â”‚
â”‚  â”‚   â€¢ collection.resources_changed                                    â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ schema.py                                                          â”‚
â”‚  â”‚   Schemas:                                                          â”‚
â”‚  â”‚   â€¢ CollectionCreate, CollectionUpdate, CollectionRead              â”‚
â”‚  â”‚   â€¢ CollectionWithResources                                         â”‚
â”‚  â”‚   â€¢ CollectionResourcesUpdate                                       â”‚
â”‚  â”‚   â€¢ CollectionRecommendation                                        â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ model.py                                                           â”‚
â”‚  â”‚   Models:                                                           â”‚
â”‚  â”‚   â€¢ Collection - Main collection model                              â”‚
â”‚  â”‚   â€¢ CollectionResource - Many-to-many association                   â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ handlers.py                                                        â”‚
â”‚  â”‚   Event Handlers:                                                   â”‚
â”‚  â”‚   â€¢ handle_resource_deleted(payload) - Remove from collections      â”‚
â”‚  â”‚   â€¢ handle_resource_updated(payload) - Update collection metadata   â”‚
â”‚  â”‚   â€¢ register_handlers() - Subscribe to resource events              â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â””â”€â”€ README.md                                                          â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Search Module Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SEARCH MODULE DETAIL                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  app/modules/search/                                                    â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ __init__.py                                                        â”‚
â”‚  â”‚   Exports:                                                          â”‚
â”‚  â”‚   â€¢ search_router                                                   â”‚
â”‚  â”‚   â€¢ hybrid_search, fts_search, vector_search                        â”‚
â”‚  â”‚   â€¢ SearchQuery, SearchResponse, SearchFacets                       â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ router.py                                                          â”‚
â”‚  â”‚   Endpoints:                                                        â”‚
â”‚  â”‚   â€¢ POST /search/hybrid    - Three-way hybrid search                â”‚
â”‚  â”‚   â€¢ POST /search/fts       - Keyword search only                    â”‚
â”‚  â”‚   â€¢ POST /search/vector    - Semantic search only                   â”‚
â”‚  â”‚   â€¢ POST /search/advanced  - Advanced search with filters           â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ service.py                                                         â”‚
â”‚  â”‚   Functions:                                                        â”‚
â”‚  â”‚   â€¢ hybrid_search(db, query, weights) â†’ SearchResponse              â”‚
â”‚  â”‚   â€¢ fts_search(db, query, filters) â†’ SearchResponse                 â”‚
â”‚  â”‚   â€¢ vector_search(db, query_text) â†’ SearchResponse                  â”‚
â”‚  â”‚   â€¢ _retrieve_candidates(...) â†’ RetrievalCandidates                 â”‚
â”‚  â”‚   â€¢ _fuse_results(...) â†’ FusedCandidates                            â”‚
â”‚  â”‚   â€¢ _rerank_with_colbert(...) â†’ List[Tuple]                         â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”‚   Search Strategies:                                                â”‚
â”‚  â”‚   â€¢ FTS5 (keyword-based, BM25 scoring)                              â”‚
â”‚  â”‚   â€¢ Dense Vector (BERT embeddings, cosine similarity)               â”‚
â”‚  â”‚   â€¢ Sparse Vector (SPLADE/TF-IDF, learned sparse)                   â”‚
â”‚  â”‚   â€¢ Reciprocal Rank Fusion (RRF)                                    â”‚
â”‚  â”‚   â€¢ ColBERT Reranking (optional)                                    â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ schema.py                                                          â”‚
â”‚  â”‚   Schemas:                                                          â”‚
â”‚  â”‚   â€¢ SearchQuery - Search request                                    â”‚
â”‚  â”‚   â€¢ SearchResponse - Search results                                 â”‚
â”‚  â”‚   â€¢ SearchFacets - Aggregations                                     â”‚
â”‚  â”‚   â€¢ SearchMetadata - Performance metrics                            â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ handlers.py                                                        â”‚
â”‚  â”‚   Event Handlers:                                                   â”‚
â”‚  â”‚   â€¢ handle_resource_updated(payload) - Update search index          â”‚
â”‚  â”‚   â€¢ handle_resource_deleted(payload) - Remove from index            â”‚
â”‚  â”‚   â€¢ register_handlers() - Subscribe to resource events              â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â””â”€â”€ README.md                                                          â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Event-Driven Communication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   EVENT-DRIVEN COMMUNICATION FLOW                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Example: Resource Deletion Flow                                        â”‚
â”‚                                                                         â”‚
â”‚  1. User Request                                                        â”‚
â”‚     DELETE /api/resources/abc-123                                       â”‚
â”‚                                                                         â”‚
â”‚  2. Resources Module                                                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ resources/router.py                                         â”‚    â”‚
â”‚     â”‚   delete_resource_endpoint(resource_id)                     â”‚    â”‚
â”‚     â”‚     â†“                                                       â”‚    â”‚
â”‚     â”‚ resources/service.py                                        â”‚    â”‚
â”‚     â”‚   delete_resource(db, resource_id)                          â”‚    â”‚
â”‚     â”‚     â€¢ Delete from database                                  â”‚    â”‚
â”‚     â”‚     â€¢ Emit event: resource.deleted                          â”‚    â”‚
â”‚     â”‚       payload = {"resource_id": "abc-123", "title": "..."}  â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                â–¼                                        â”‚
â”‚  3. Event Bus                                                           â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ shared/event_bus.py                                         â”‚    â”‚
â”‚     â”‚   emit("resource.deleted", payload)                         â”‚    â”‚
â”‚     â”‚     â€¢ Look up registered handlers                           â”‚    â”‚
â”‚     â”‚     â€¢ Execute handlers in priority order                    â”‚    â”‚
â”‚     â”‚     â€¢ Isolate errors (don't stop other handlers)            â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                â–¼                                        â”‚
â”‚  4. Collections Module Handler                                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ collections/handlers.py                                     â”‚    â”‚
â”‚     â”‚   handle_resource_deleted(payload)                          â”‚    â”‚
â”‚     â”‚     â€¢ Get resource_id from payload                          â”‚    â”‚
â”‚     â”‚     â€¢ Remove resource from all collections                  â”‚    â”‚
â”‚     â”‚     â€¢ Update collection metadata                            â”‚    â”‚
â”‚     â”‚     â€¢ Emit: collection.updated (if changed)                 â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â”‚  5. Search Module Handler (Future)                                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ search/handlers.py                                          â”‚    â”‚
â”‚     â”‚   handle_resource_deleted(payload)                          â”‚    â”‚
â”‚     â”‚     â€¢ Remove from search index                              â”‚    â”‚
â”‚     â”‚     â€¢ Update search statistics                              â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â”‚  Benefits:                                                              â”‚
â”‚  â€¢ Resources module doesn't know about Collections                      â”‚
â”‚  â€¢ Collections module doesn't know about Resources                      â”‚
â”‚  â€¢ New modules can subscribe to events without modifying existing code  â”‚
â”‚  â€¢ Error in one handler doesn't affect others                           â”‚
â”‚  â€¢ Easy to add new event subscribers                                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Migration Progress

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MIGRATION PROGRESS TRACKER                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  âœ… Phase 1: Shared Kernel Setup                                        â”‚
â”‚     â€¢ Created app/shared/ directory                                     â”‚
â”‚     â€¢ Extracted database.py (Base, SessionLocal, get_sync_db)           â”‚
â”‚     â€¢ Extracted event_bus.py (EventBus, EventPriority)                  â”‚
â”‚     â€¢ Extracted base_model.py (Base, GUID)                              â”‚
â”‚                                                                         â”‚
â”‚  âœ… Phase 2: Collections Module                                         â”‚
â”‚     â€¢ Created app/modules/collections/ structure                        â”‚
â”‚     â€¢ Moved router, service, schema to module                           â”‚
â”‚     â€¢ Created event handlers for resource events                        â”‚
â”‚     â€¢ Extracted Collection and CollectionResource models                â”‚
â”‚     â€¢ Verified event-driven communication                               â”‚
â”‚                                                                         â”‚
â”‚  âœ… Phase 3: Event-Driven Decoupling                                    â”‚
â”‚     â€¢ Replaced direct service calls with event emissions                â”‚
â”‚     â€¢ Implemented resource.deleted â†’ collection cleanup                 â”‚
â”‚     â€¢ Implemented resource.updated â†’ collection metadata update         â”‚
â”‚     â€¢ Added comprehensive event monitoring                              â”‚
â”‚     â€¢ Created integration tests for event flow                          â”‚
â”‚                                                                         â”‚
â”‚  âœ… Phase 4: Resources Module                                           â”‚
â”‚     â€¢ Created app/modules/resources/ structure                          â”‚
â”‚     â€¢ Moved router, service, schema to module                           â”‚
â”‚     â€¢ Extracted Resource model with string-based relationships          â”‚
â”‚     â€¢ Created event handlers (placeholder for collection.updated)       â”‚
â”‚     â€¢ Verified all 8 resource events are emitted correctly              â”‚
â”‚     â€¢ Maintained backward compatibility                                 â”‚
â”‚                                                                         â”‚
â”‚  âœ… Phase 5: Search Module                                              â”‚
â”‚     â€¢ Created app/modules/search/ structure                             â”‚
â”‚     â€¢ Consolidated multiple search services into unified module         â”‚
â”‚     â€¢ Moved router and schema to module                                 â”‚
â”‚     â€¢ Created event handlers for resource updates                       â”‚
â”‚     â€¢ Maintained three-way hybrid search functionality                  â”‚
â”‚                                                                         â”‚
â”‚  ğŸ”„ Phase 6: Application Entry Point (In Progress)                      â”‚
â”‚     â€¢ Update main.py to register module routers                         â”‚
â”‚     â€¢ Register event handlers on startup                                â”‚
â”‚     â€¢ Maintain API backward compatibility                               â”‚
â”‚     â€¢ Add module health checks                                          â”‚
â”‚                                                                         â”‚
â”‚  â³ Phase 7: Cleanup and Documentation (Pending)                        â”‚
â”‚     â€¢ Remove deprecated layered structure files                         â”‚
â”‚     â€¢ Update all documentation                                          â”‚
â”‚     â€¢ Create migration guide for developers                             â”‚
â”‚     â€¢ Add module-specific documentation                                 â”‚
â”‚                                                                         â”‚
â”‚  â³ Future: Additional Modules (Planned)                                â”‚
â”‚     â€¢ Authority Control Module                                          â”‚
â”‚     â€¢ Classification Module                                             â”‚
â”‚     â€¢ Quality Module                                                    â”‚
â”‚     â€¢ Annotation Module                                                 â”‚
â”‚     â€¢ Graph Module                                                      â”‚
â”‚     â€¢ Recommendation Module                                             â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Architecture Evolution Summary

Neo Alexandria 2.0 has evolved through 12+ phases, each building upon the previous foundation:

**Phase 1-3**: Core CRUD operations, basic search, taxonomy management  
**Phase 4**: Advanced hybrid search (FTS5 + vector)  
**Phase 5-7**: ML classification with active learning  
**Phase 8**: Three-way hybrid search with reranking  
**Phase 9**: Quality assessment and monitoring  
**Phase 10**: Graph-based recommendations  
**Phase 11**: Domain-driven design refactoring  
**Phase 12**: Fowler refactoring framework  
**Phase 12.5**: Event-driven architecture with Celery  
**Phase 13**: PostgreSQL migration with full-text search  
**Phase 13.5**: Vertical slice architecture with modular design (Collections, Resources, Search modules)

### Current System Features

The system now features:
- **Modular vertical slice architecture** with self-contained modules (Collections, Resources, Search)
- **Event-driven communication** via shared event bus for loose coupling
- **9 distinct architectural layers** working in harmony
- **10+ design patterns** applied throughout
- **Event-driven consistency** with automatic task orchestration
- **Multi-level caching** for 50-70% performance improvement
- **Distributed task processing** with priority queues
- **Rich domain models** with business logic encapsulation
- **ML-powered features** (classification, embeddings, quality assessment)
- **Three-way hybrid search** with multiple retrieval strategies
- **Comprehensive monitoring** and observability
- **PostgreSQL and SQLite support** with database-agnostic abstractions

### Design Principles

The architecture is designed for:
- **Scalability**: Horizontal scaling of services, workers, and cache
- **Reliability**: Automatic retries, health checks, graceful degradation
- **Performance**: Sub-second response times with caching
- **Maintainability**: Clear separation of concerns, testable components
- **Extensibility**: Plugin architecture for new strategies and features

### Key Architectural Decisions

1. **Vertical Slice Architecture**: Self-contained modules (Collections, Resources, Search) with all layers encapsulated
2. **Event-Driven Design**: Loose coupling through events enables automatic consistency maintenance and eliminates circular dependencies
3. **Shared Kernel**: Common infrastructure (database, event bus, base models) shared across modules
4. **Layered Architecture**: Clear separation between presentation, domain, service, event, task, cache, data access, database, and ML layers
5. **Asynchronous Processing**: Celery task queue handles long-running operations without blocking API responses
6. **Multi-Level Caching**: Redis cache dramatically reduces computation time for repeated operations
7. **Domain-Driven Design**: Rich domain objects encapsulate business logic and validation
8. **ML Integration**: Lazy-loaded models with GPU acceleration for efficient inference
9. **Hybrid Search**: Combines keyword, dense vector, and sparse vector search for optimal results
10. **Quality Assessment**: Multi-dimensional quality scoring with outlier detection
11. **Database Flexibility**: Support for both PostgreSQL (production) and SQLite (development/testing)

---

*For implementation details, see individual service documentation and inline code comments.*
